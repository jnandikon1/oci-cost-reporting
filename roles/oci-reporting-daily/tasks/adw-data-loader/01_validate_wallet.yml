---
# Validate ADW wallet files are present and accessible

- name: Create ADW wallet directory if missing
  file:
    path: "{{ adw_wallet_path }}"
    state: directory
    mode: '0700'
  tags:
    - load-database
    - validate

- name: Check ADW wallet exists
  stat:
    path: "{{ adw_wallet_path }}"
  register: wallet_stat
  tags:
    - load-database
    - validate

- name: Assert wallet directory exists
  assert:
    that:
      - wallet_stat.stat.exists
      - wallet_stat.stat.isdir
    fail_msg: "ADW wallet directory not found at {{ adw_wallet_path }}"
    success_msg: "✓ ADW wallet directory validated"
  tags:
    - load-database
    - validate

- name: Find wallet files
  find:
    paths: "{{ adw_wallet_path }}"
    patterns: "*.pem,*.p12,sqlnet.ora,tnsnames.ora"
    file_type: file
  register: wallet_files
  tags:
    - load-database
    - validate

- name: Assert wallet contains required files
  assert:
    that:
      - wallet_files.files | length > 0
    fail_msg: "No wallet files found in {{ adw_wallet_path }}"
    success_msg: "✓ Wallet files validated ({{ wallet_files.files | length }} files)"
  tags:
    - load-database
    - validate

- name: Display wallet validation results
  debug:
    msg: |
      ✓ Wallet Validation Results:
        Location: {{ adw_wallet_path }}
        Files Found: {{ wallet_files.files | length }}
        Required Files:
      {% for file in wallet_files.files %}
          - {{ file.path | basename }}
      {% endfor %}
  tags:
    - load-database
    - validate
