----oci_save_ocpu_data.yml
- name: OCI Save OCPU data in OEM Database
  hosts: all
  gather_facts: False
  vars:
  roles:
  - oci_save_ocpu_data
---------------------------------------------------------------------------------------------------------------------------------------
----oci_ocpu_reporting.yml
- name: OCI OCPU Reporting
  hosts: all
  gather_facts: False
  vars:
  roles:
  - oci_ocpu_reporting
---------------------------------------------------------------------------------------------------------------------------------------
----oci_monthly_reporting.yml
- name: OCI Monthly Reporting for Cost
  hosts: all
  gather_facts: False
  vars:
  roles:
  - oci_monthly_reporting
---------------------------------------------------------------------------------------------------------------------------------------
----oci_monthly_cost_updates.yml
- name: OCI Monthly Cost Update for Monthly Reporting
  hosts: all
  gather_facts: False

  vars:

  roles:
  - oci_monthly_cost_updates
---------------------------------------------------------------------------------------------------------------------------------------
----oci_daily_reporting.yml
- name: OCI Daily Reporting for Cost and OCPU values
  hosts: all
  gather_facts: False

  vars:

  roles:
  - oci_daily_reporting
---------------------------------------------------------------------------------------------------------------------------------------
----logfile_cleanup.yml
- name: Launching Log File Cleanup Playbook
  hosts: all
  gather_facts: False

  vars:
    path_dir: "{{ path_dir }}"

  roles:
  - logfile_cleanup

---------------------------------------------------------------------------------------------------------------------------------------
----roles\logfile_cleanup\tasks\main.yml
# cleaning up all logs
- name: Getting logs files to cleanup
  find:
    paths: "{{ path_dir }}"
    patterns: "*.*"
  register: files_to_delete

- name: Cleaning up log files
  file:
     path: "{{ item.path }}"
     state: absent
  with_items: "{{ files_to_delete.files }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_daily_reporting\tasks\main.yml
#
# settings facts
#
- name: Getting facts
  include: set_facts.yml


#
# Make folder for Working Log Directory
#
- name: Creating logs folder if missing
  file:
    path: "{{ working_log_dir }}"
    state: directory
#
# Make folder for Working Scripts Directory
#
- name: Creating script folder if missing
  file:
    path: "{{ working_script_dir }}"
    state: directory


#
# Copy sql script for the SQL email Body information
#
- name: Deploying SQL Script
  template:
    src:  "{{ email_body_file_name }}"
    dest: "{{ email_body_info }}"
  when: var_past_report_type  == Literal_SQL


#
# Copy sql script for SQL reports
#
- name: Deploying SQL Script
  template:
    src:  "{{ sql_file_name }}"
    dest: "{{ sql_script }}"
  when: var_past_report_type  == Literal_SQL

#
# Copy sql script for HTML Reports
#
- name: Deploying SQL Script
  template:
    src:  "{{ sql_file_name_html }}"
    dest: "{{ sql_script_html }}"
  when: var_past_report_type  == Literal_HTML


#
# ############## This is for running and emailing the SQL file ################
#

#
# Create the OCPU report for SQL format
#
- name: Generating reports
  shell: 'export LD_LIBRARY_PATH=/oracle/product/zdmhome/lib && sqlplus -S etc_repository/{{var_etc_repository_password}}@OAITERP @{{ sql_script }}'
  when: var_past_report_type  == Literal_SQL

#
# Email the report for SQL file and attached to the report
#

- name: Email the OCPU report and attach the output
  shell: " mutt -s '{{ email_subject }}' -a  {{ spool_file }} -- {{ var_email_address_list }} < {{ email_body_info }} "
  when: var_past_report_type  == Literal_SQL




#
# ############## This is for running and emailing the HTML Report ################
#

#
# Create the OCPU report for HTML format
#
- name: Generating reports
  shell: 'export LD_LIBRARY_PATH=/oracle/product/zdmhome/lib && sqlplus -S etc_repository/{{var_etc_repository_password}}@OAITERP @{{ sql_script_html }}'
  when: var_past_report_type  == Literal_HTML


- name: Slurp the report file content
  slurp:
    src: "{{ spool_file_html }}"
  register: report_content

#
# send email in HTML format
#

- name: Sending email with reports
  mail:
    host: "{{ smtp_host }}"
    port: 25
    from:      "{{ from_email_address }}"
    to:        "{{ var_email_address_list }}"
    subject:   "{{ email_subject }}"
    subtype: html
    body: "{{ report_content.content | b64decode }}"
  when: var_past_report_type  == Literal_HTML
#
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_daily_reporting\tasks\set_facts.yml
#
# set global facts from Survey
#
- name: Setting facts from Survery
  set_fact:
    var_email_address_list:         "{{ past_email_address | upper }}"
    var_monthly_max_cost:           "{{ past_monthly_max_cost }}"
    var_etc_repository_password:    "{{ past_password }}"
    var_starting_date_nbr:          "{{ past_starting_date_nbr }}"
    var_past_report_type:           "{{ past_report_type | upper }}"



#
# Get the Date for report files names
#

- name: Get timestamp from the system to use to format the AWR report file name
  shell: date '+%Y_%m_%d_%H_%M'
  register: tstamp_file_format

- name: Setting facts for the file format date-time
  set_fact:
     var_file_format:                  "{{ tstamp_file_format.stdout}}"



#
# set global facts for Main Directory and Literal Values
#
- name: Setting global facts for main directory
  set_fact:
    working_dir:        "/export/home/oracle/OCPU-DATA"
    working_dir_report: "/dbutil/oracle/oci/ocpu"
    Literal_SQL:        "SQL"
    Literal_HTML:       "HTML"

#
# set global facts for Folder Literal values
#
- name: Setting Global Facts for Folder Directores
  set_fact:
    working_log_dir:         "{{ working_dir_report }}/reports"
    working_script_dir:      "{{ working_dir }}/scripts"
    #
    sql_file_name:           "generate_oci_ocpu_health_check_report.sql"
    sql_file_name_html:      "generate_oci_ocpu_health_check_report_html.sql"
    #
    email_body_file_name:    "email_body_information.txt"
    #
    log_file_name_html:      "oci_ocpu_daily_report.html"
    log_file_name:           "oci_ocpu_daily_report.log"
    #
    source_file:             "/home/oracle"
    #
    from_email_address:      "DLITISOracle@energytransfer.com"
    smtp_host:               "localhost"
    #
    email_subject:           "OCPU:  Daily Health Check Report from OCI"
    email_body:              "OCPU:  Daily Health Check Report from OCI"

#
# setting global facts
#
- name: Setting global facts for directories
  set_fact:
    sql_script:          "{{ working_script_dir }}/{{sql_file_name}}"
    sql_script_html:     "{{ working_script_dir }}/{{sql_file_name_html}}"
    #
    email_body_info:     "{{ working_log_dir }}/{{email_body_file_name}}"
    #
    spool_file_html:     "{{ working_log_dir }}/{{var_file_format}}-{{log_file_name_html}}"
    spool_file:          "{{ working_log_dir }}/{{var_file_format}}-{{log_file_name}}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_daily_reporting\templates\email_body_information.txt
Team,

Please see the attached file for the Daily OCPU report:
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_daily_reporting\templates\generate_oci_ocpu_health_check_report_html.sql
SET ECHO OFF
SET MARKUP HTML ON SPOOL ON
SET FEEDBACK ON
SET PAGESIZE 2000
alter session set nls_date_format = 'MM/DD/YYYY HH24:MI';





spool {{ spool_file_html }}


--
-- Date and Monthly Cost --------------------------------------------
--

SET MARKUP HTML ENTMAP OFF
PROMPT <H2><center><b> OCI: Reporting Date for the OCPU Health Check Report   </b></center></H2>
SET MARKUP HTML ENTMAP ON

select 'Report Date: ' || to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day') as Report_Date from dual ;
select 'Daily Maximum Cost Target:  $' || to_char( {{ var_monthly_max_cost }} ) as Daily_Maximum_Cost_Target from dual ;

SET MARKUP HTML ENTMAP OFF


--
-- OCPU Cost for the Day --------------------------------------------
--

PROMPT <H2><center><b> OCI: OCPU Costs Breakdown  </b></center></H2>
SET MARKUP HTML ENTMAP ON

column Daily_cost     format 999,999,999.99
column Reporting_Day  format a20
column OCPU_CATAGORY  format a20
column Catagories     format a30

break  on Reporting_Day

compute sum label 'Total for the Day: ' of "Daily_Cost"  on Reporting_Day




select OCPU_DT_DAY                                as Reporting_Day,
       OCPU_CATAGORY                              as Catagories ,
       sum(Cost_per_hour_from_total_OCPU)         as Daily_Cost
from (
---------------
--Production -- ExaCC - B91363
---------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')     as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527               as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('prdcluster1','prdcluster2','prdcluster3','prdcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
--NonProduction -- ExaCC - B91363
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('devcluster1','devcluster2','devcluster3','devcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
---------------------
--DisasterRecovery -- ExaCC - B91363
---------------------
    select  to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
    from    etc_repository.v_ocpu_reporting
    where   to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('drcluster1','drcluster2')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
-----------------
--ET-OCI-AppOkv -  OKV application servers ?B88514  0.0574?????????????????????????  sum(ocpu_value)  *  0.0812990196078431   as Cost_per_hour_from_total_OCPU,
-----------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0574                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('CETORCXAPOK1P','CETORCXAPOK2P','CETORCXAPOK3P','CETORCXAPOK4P','ET-OKV-BK-OLE8-VM')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
-- ET-OCI-AppDev -  GoldenGate application servers - B92992
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  1.2097                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'GoldenGate'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------
--ET-OCI-App -  OEM Application servers  - B93113
--------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  0.0225                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OEM-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OCI-Database -  OEM Databases - B90570
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.3871                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OEM-Database'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------------------------------
-- ET-OID-Instance Production -  B93113 --
------------------------------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------------------------------
-- ET-OID-Instance Recovery -  B93113 --
------------------------------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-R-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
-------------------------------------------
-- ET-OID-Instance Development -  B93113 --
-------------------------------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Dev-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- Other adjustment -  was 11.333    21.31
--------------------
   select   to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            to_number('21.31')                             as Cost_per_hour_from_total_OCPU,
            'Other (consistent charges)'                   as OCPU_CATAGORY
   from     dual)
   where  OCPU_DT_DAY  = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day')
group by  OCPU_DT_DAY ,
          OCPU_CATAGORY
order by 1,2;



SET MARKUP HTML ENTMAP OFF


--
-- OCPU Cost for the Month --------------------------------------------
--

PROMPT <H2><center><b>  OCI: OCPU Costs Breakdown for the Month  </b></center></H2>
SET MARKUP HTML ENTMAP ON

clear breaks


column Daily_cost format 999,999,999.99
column Cost_Under_Over format 999,999,999.99
column Reporting_Day  format a20
column Under_Over_Indicator format a20

break on report
  compute sum label 'Total Month to Date: ' of "Daily_Cost"  on report

  compute sum label 'Cost Under Over: ' of "Cost_Under_Over"  on report




select OCPU_DT_DAY                                as Reporting_Day,
       sum(Cost_per_hour_from_total_OCPU)         as Daily_Cost,
       ( Case  when sum(Cost_per_hour_from_total_OCPU) >  {{ var_monthly_max_cost }}  then '******* Over *******'   else  '               Under'  end)   as Under_Over_Indicator,
       sum(Cost_per_hour_from_total_OCPU) -  {{ var_monthly_max_cost }}       Cost_Under_Over
from (
---------------
--Production -- ExaCC
---------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527               as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('prdcluster1','prdcluster2','prdcluster3','prdcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
--NonProduction -- ExaCC
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('devcluster1','devcluster2','devcluster3','devcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
---------------------
--DisasterRecovery -- ExaCC
---------------------
    select  to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
    from    etc_repository.v_ocpu_reporting
    where   to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and OCPU_ENTITY_NAME in ('drcluster1','drcluster2')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
-----------------
--ET-OCI-AppOkv -  OKV application servers  0.0574  0.0812990196078431
-----------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *    0.0574    as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('CETORCXAPOK1P','CETORCXAPOK2P','CETORCXAPOK3P','CETORCXAPOK4P','ET-OKV-BK-OLE8-VM')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
-- ET-OCI-AppDev -  GoldenGate application servers
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  1.2097              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'GoldenGate'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------
--ET-OCI-App -  OEM Application servers
--------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  0.0225              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and OCPU_CATAGORY = 'OEM-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OCI-Database -  OEM Databases
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.3871             as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OEM-Database'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OID-Instance -  OID Production
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OID-Instance -  OID Recovery
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-R-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OID-Instance -  OID Development
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Dev-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- Other adjustment -  was 11.31  now 21.31
--------------------
   select   to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day')      as OCPU_DT_DAY ,
            to_number('21.31')                         as Cost_per_hour_from_total_OCPU,
              'Other (consistent charges)'             as OCPU_CATAGORY
   from     dual)
group by  OCPU_DT_DAY
order by 1 asc;



SET MARKUP HTML ENTMAP OFF



--
-- OCPU Counts high level --------------------------------------------
--

PROMPT <H2><center><b> OCI: OCPU Counts  </b></center></H2>
SET MARKUP HTML ENTMAP ON

clear breaks


column Catagories    format a18
column Average_OCPU  format 999999
column Servers_and_Application format a28
column Reporting_Day  format a34

Break on ocpu_catagory on report

compute sum label 'Total (average) OCPU for the Day: ' of "Average_OCPU"  on report

select to_char(ocpu_date,'YYYY-MM-DD Day') as Reporting_Day,
       ocpu_catagory      as Catagories ,
       ocpu_Entity_name   as Servers_and_Application,
       avg(ocpu_value)    as Average_OCPU
from   etc_repository.v_ocpu_reporting
where  to_char(ocpu_date,'YYYY-MM-DD') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD')
group by to_char(ocpu_date,'YYYY-MM-DD Day'), ocpu_catagory,ocpu_Entity_name
order by 1,2;


SET MARKUP HTML ENTMAP OFF

--
-- OCPU Counts Details --------------------------------------------
--

PROMPT <H2><center><b> OCI: Average OCPU counts from ExaCC for the Month  </b></center></H2>
SET MARKUP HTML ENTMAP ON


clear breaks

column Report_date         format a25
column Average_OCPU        format 999999
column Cluster_name        format a15
column Standard_Deviation  format 999,99.99
column Min_value           format 999,99.99
column Max_value           format 999,99.99
column Min_Max_Difference  format 999,99.99



break on Cluster_name skip 1

select to_char(ocpu_date,'YYYY-MM-DD Day') as Report_date  ,
       ocpu_Entity_name                    as Cluster_name,
       avg(ocpu_value)                     as Average_OCPU,
       stddev(ocpu_value)                  as Standard_Deviation ,
       min(ocpu_value)                     as Min_Value,
       max(ocpu_value)                     as Max_Value,
       max(ocpu_value) -min(ocpu_value)    as Min_Max_Difference
from   etc_repository.v_ocpu_reporting
where  to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and ocpu_catagory = 'Exacc'
group by to_char(ocpu_date,'YYYY-MM-DD Day'),ocpu_Entity_name
order by 2 desc ,1 ;



SET MARKUP HTML ENTMAP OFF



--
-- OCPU Check for Any Missing data points --------------------------------------------
--


PROMPT <H2><center><b> OCI: Check for Missing Data  </b></center></H2>
SET MARKUP HTML ENTMAP ON

clear breaks

column Report_date        format a25

select to_char(ocpu_date,'YYYY-MM-DD HH24') as Report_date  ,
       count(*)                             as Data_points
from   etc_repository.v_ocpu_reporting
where  to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and
       ocpu_date > TO_DATE('07-06-2024 15:00:00','dd-mm-yyyy hh24:mi:ss')
group  by to_char(ocpu_date,'YYYY-MM-DD HH24')
having count(*) != 30
order  by  1;



SET MARKUP HTML ENTMAP OFF


exit;
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_daily_reporting\templates\generate_oci_ocpu_health_check_report.sql
SET ECHO OFF
SET PAGESIZE 2000
set linesize 200
SET FEEDBACK ON

alter session set nls_date_format = 'MM/DD/YYYY HH24:MI';

spool {{ spool_file }}

--
-- Date and Monthly Cost --------------------------------------------
--
TTITLE CENTER SKIP 1 'OCI: Reporting Date for the OCPU Health Check Report'  SKIP 2

select 'Report Date: ' || to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day') as Report_Date from dual ;
select 'Daily Maximum Cost Target:  $' || to_char( {{ var_monthly_max_cost }} ) as Daily_Maximum_Cost_Target from dual ;

--
-- OCPU Cost for the Day --------------------------------------------
--

TTITLE CENTER SKIP 1 'OCI: OCPU Costs Breakdown'  SKIP 2

column Daily_cost     format 999,999,999.99
column Reporting_Day  format a20
column OCPU_CATAGORY  format a20
column Catagories     format a30

break  on Reporting_Day

compute sum label 'Total for the Day: ' of "Daily_Cost"  on Reporting_Day

select OCPU_DT_DAY                                as Reporting_Day,
       OCPU_CATAGORY                              as Catagories ,
       sum(Cost_per_hour_from_total_OCPU)         as Daily_Cost
from (
---------------
--Production -- ExaCC - B91363
---------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')     as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527               as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('prdcluster1','prdcluster2','prdcluster3','prdcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
--NonProduction -- ExaCC - B91363
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('devcluster1','devcluster2','devcluster3','devcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
---------------------
--DisasterRecovery -- ExaCC - B91363
---------------------
    select  to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
    from    etc_repository.v_ocpu_reporting
    where   to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('drcluster1','drcluster2')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
-----------------
--ET-OCI-AppOkv -  OKV application servers ?B88514  0.0574?????????????????????????  sum(ocpu_value)  *  0.0812990196078431   as Cost_per_hour_from_total_OCPU,
-----------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0574                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('CETORCXAPOK1P','CETORCXAPOK2P','CETORCXAPOK3P','CETORCXAPOK4P','ET-OKV-BK-OLE8-VM')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
-- ET-OCI-AppDev -  GoldenGate application servers - B92992
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  1.2097                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'GoldenGate'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------
--ET-OCI-App -  OEM Application servers  - B93113
--------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  0.0225                  as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OEM-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OCI-Database -  OEM Databases - B90570
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.3871                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OEM-Database'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------------------------------
-- ET-OID-Instance Production -  B93113 --
------------------------------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------------------------------
-- ET-OID-Instance Recovery -  B93113 --
------------------------------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-R-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
-------------------------------------------
-- ET-OID-Instance Development -  B93113 --
-------------------------------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Dev-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- Other adjustment -  was 11.333    21.31
--------------------
   select   to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            to_number('21.31')                             as Cost_per_hour_from_total_OCPU,
            'Other (consistent charges)'                   as OCPU_CATAGORY
   from     dual)
   where  OCPU_DT_DAY  = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day')
group by  OCPU_DT_DAY ,
          OCPU_CATAGORY
order by 1,2;


--
-- OCPU Cost for the Month --------------------------------------------
--

TTITLE CENTER SKIP 1 'OCI: OCPU Costs Breakdown for the Month'  SKIP 2

clear breaks
column Daily_cost format 999,999,999.99
column Cost_Under_Over format 999,999,999.99
column Reporting_Day  format a20
column Under_Over_Indicator format a20

break on report
compute sum label 'Total Month to Date: ' of "Daily_Cost"  on report
compute sum label 'Cost Under Over: ' of "Cost_Under_Over"  on report


select OCPU_DT_DAY                                as Reporting_Day,
       sum(Cost_per_hour_from_total_OCPU)         as Daily_Cost,
       ( Case  when sum(Cost_per_hour_from_total_OCPU) >  {{ var_monthly_max_cost }}  then '******* Over *******'   else  '               Under'  end)   as Under_Over_Indicator,
       sum(Cost_per_hour_from_total_OCPU) -  {{ var_monthly_max_cost }}       Cost_Under_Over
from (
---------------
--Production -- ExaCC
---------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527               as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('prdcluster1','prdcluster2','prdcluster3','prdcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
--NonProduction -- ExaCC
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('devcluster1','devcluster2','devcluster3','devcluster4')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
---------------------
--DisasterRecovery -- ExaCC
---------------------
    select  to_char(ocpu_date,'YYYY-MM-DD Day')        as OCPU_DT_DAY ,
            sum(ocpu_value)  *  .7527              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
    from    etc_repository.v_ocpu_reporting
    where   to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and OCPU_ENTITY_NAME in ('drcluster1','drcluster2')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
-----------------
--ET-OCI-AppOkv -  OKV application servers  0.0574  0.0812990196078431
-----------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *    0.0574    as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_ENTITY_NAME in ('CETORCXAPOK1P','CETORCXAPOK2P','CETORCXAPOK3P','CETORCXAPOK4P','ET-OKV-BK-OLE8-VM')
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
------------------
-- ET-OCI-AppDev -  GoldenGate application servers
------------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  1.2097              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'GoldenGate'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------
--ET-OCI-App -  OEM Application servers
--------------
   select   to_char(ocpu_date,'YYYY-MM-DD Day')         as OCPU_DT_DAY ,
            sum(ocpu_value)  *  0.0225              as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and OCPU_CATAGORY = 'OEM-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OCI-Database -  OEM Databases
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.3871             as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OEM-Database'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OID-Instance -  OID Production
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OID-Instance -  OID Recovery
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-R-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- ET-OID-Instance -  OID Development
--------------------
   select  to_char(ocpu_date,'YYYY-MM-DD Day')          as OCPU_DT_DAY ,
            sum(ocpu_value)  *   0.0225                 as Cost_per_hour_from_total_OCPU,
            OCPU_CATAGORY
   from     etc_repository.v_ocpu_reporting
   where    to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM')  and OCPU_CATAGORY = 'OID-Dev-Application'
   group by to_char(ocpu_date,'YYYY-MM-DD Day'),
            OCPU_CATAGORY
union
--------------------
-- Other adjustment -  was 11.31  now 21.31
--------------------
   select   to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD Day')      as OCPU_DT_DAY ,
            to_number('21.31')                         as Cost_per_hour_from_total_OCPU,
              'Other (consistent charges)'             as OCPU_CATAGORY
   from     dual)
group by  OCPU_DT_DAY
order by 1 asc;


--
-- OCPU Counts high level --------------------------------------------
--

clear breaks

TTITLE CENTER SKIP 1 'OCI: OCPU Counts'  SKIP 2

column Catagories    format a18
column Average_OCPU  format 999999
column Servers_and_Application format a28
column Reporting_Day  format a34

Break on ocpu_catagory on report

compute sum label 'Total (average) OCPU for the Day: ' of "Average_OCPU"  on report

select to_char(ocpu_date,'YYYY-MM-DD Day') as Reporting_Day,
       ocpu_catagory      as Catagories ,
       ocpu_Entity_name   as Servers_and_Application,
       avg(ocpu_value)    as Average_OCPU
from   etc_repository.v_ocpu_reporting
where  to_char(ocpu_date,'YYYY-MM-DD') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM-DD')
group by to_char(ocpu_date,'YYYY-MM-DD Day'), ocpu_catagory,ocpu_Entity_name
order by 1,2;

--
-- OCPU Counts Details --------------------------------------------
--

TTITLE CENTER SKIP 1 'OCI: Average OCPU counts from ExaCC for the Month'  SKIP 2

clear breaks
column Report_date         format a25
column Average_OCPU        format 999999
column Cluster_name        format a15
column Standard_Deviation  format 999,99.99
column Min_value           format 999,99.99
column Max_value           format 999,99.99
column Min_Max_Difference  format 999,99.99


break on Cluster_name skip 1

select to_char(ocpu_date,'YYYY-MM-DD Day') as Report_date  ,
       ocpu_Entity_name                    as Cluster_name,
       avg(ocpu_value)                     as Average_OCPU,
       stddev(ocpu_value)                  as Standard_Deviation ,
       min(ocpu_value)                     as Min_Value,
       max(ocpu_value)                     as Max_Value,
       max(ocpu_value) -min(ocpu_value)    as Min_Max_Difference
from   etc_repository.v_ocpu_reporting
where  to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and ocpu_catagory = 'Exacc'
group by to_char(ocpu_date,'YYYY-MM-DD Day'),ocpu_Entity_name
order by 2 desc ,1 ;


--
-- OCPU Check for Any Missing data points --------------------------------------------
--


TTITLE CENTER SKIP 1 'OCI: Check for Missing Data'  SKIP 2

clear breaks
column Report_date        format a25

select to_char(ocpu_date,'YYYY-MM-DD HH24') as Report_date  ,
       count(*)                             as Data_points
from   etc_repository.v_ocpu_reporting
where  to_char(ocpu_date,'YYYY-MM') = to_char(sysdate - {{ var_starting_date_nbr }},'YYYY-MM') and
       ocpu_date > TO_DATE('07-06-2024 15:00:00','dd-mm-yyyy hh24:mi:ss')
group  by to_char(ocpu_date,'YYYY-MM-DD HH24')
having count(*) != 30
order  by  1;

exit;
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_cost_updates\tasks\main.yml
#
# Logic
#
# 01) Call the OEM cloud database to derive the dates needed to call the OCI and Update the Oracle database tables
# 02) Call OCI CLI using retrieve the cost information
# 03) Update the Oracle database table with the latest cost information
#      Table:  etc_repository.v_ocpu_monthly_reporting    column: OCPU_OCI_MONTHLY_VALUE


#
# settings facts
#
- name: Getting facts
  include: set_facts.yml

#
#  ------------------------------------------------------------------------
#  -------------------  Verify the Working Folder Exists ------------------
#  ------------------------------------------------------------------------
#

#
# Make folder for Working Log Directory
#
- name: Creating logs folder if missing
  file:
    path: "{{ working_log_dir }}"
    state: directory

#
# Make folder for Working Scripts Directory
#
- name: Creating script folder if missing
  file:
    path: "{{ working_script_dir }}"
    state: directory

#
# create working directory for save report directory
#
- name: Creating main directory for the save report directory
  file:
    path: "{{ save_data_dir  }}"
    state: directory



#
#  ------------------------------------------------------------------------
#  ------------------- Copy the SQL files to the server -------------------
#  ------------------------------------------------------------------------
#


#
# Copy sql script for SQL to Create OCI Call
#
- name: Deploying SQL Script - Copy sql script for SQL to Create OCI Call
  template:
    src:  "{{ sql_oci_file_name }}"
    dest: "{{ sql_oci_script }}"


#
# Copy sql script for SQL to extract dates
#
- name: Deploying SQL Script - Copy sql script for SQL to extract dates
  template:
    src:  "{{ sql_dates_file_name }}"
    dest: "{{ sql_date_script }}"



#
#  ---------------------------------------------------------------------------------------------------------
#  ----------- Call the database to determine the OCI DATE(s) needed to call OCI via CLI command  ----------
#  ---------------------------------------------------------------------------------------------------------
#

#
# Generating OCI Call information by using the Oracle database to derive the dates
#
- name: Generating OCI Call information by using the Oracle database to derive the dates
  shell: 'export LD_LIBRARY_PATH=/oracle/product/zdmhome/lib && sqlplus -S etc_repository/{{var_etc_repository_password}}@OAITERP @{{ sql_oci_script }}'
  register: sql_oci_data_register
  failed_when: "'ORA-' in sql_oci_data_register.stdout"

- name: Save oci data from register
  set_fact:
     sql_oci_data_register_data:                  "{{ sql_oci_data_register.stdout }}"



#
#  -----------------------------------------------------------------------------------------------------------
#  ------- Call the database to generate "WHERE" statement that will be used to update the cost information ----
#  ------------------------------------------------------------------------------------------------------------
#

#
# Generating Oracle "WHERE" statement that will used to determine which row to update for the time peroid
#
- name: Generating Oracle "WHERE" statement that will used to determine which row to update for the time peroid
  shell: 'export LD_LIBRARY_PATH=/oracle/product/zdmhome/lib && sqlplus -S etc_repository/{{var_etc_repository_password}}@OAITERP @{{ sql_date_script }}'
  register: sql_date_data_register
  failed_when: "'ORA-' in sql_date_data_register.stdout"

- name: Save sql cost WHERE statement from register
  set_fact:
     sql_date_data_register_data:                  "{{ sql_date_data_register.stdout }}"



#
#  -------------------------------------------------
#  ------- Call OCI to get the cost information ----
#  --------------------------------------------------
#


#
# Copy shell script for CLI call to OCI to get costs
#
- name: Deploying Shell Script to extract OCI CLI cost information
  template:
    src:  "{{ shell_extract_cost_from_oci }}"
    dest: "{{ shell_cost_extract_script }}"

# execute shell script for CLI call to get the OCI costs information
- name: Executing OCI OCPU capure data script
  shell: "sh {{ shell_cost_extract_script }}"



# Cat the cost information so that it can be used to update the Monthly table
- name: Executing - cat to capture the cost information
  shell: "cat {{ oci_cli_cost_working_file_02_loc }}"
  register: ocu_cost_data

- name: Save sql cost information so the database can be updated for the time period the information was captured
  set_fact:
     cost_data_from_oci:                  "{{ ocu_cost_data.stdout }}"



#
#  --------------------------------------------------------
#  ------- Update the Cost information in the database ----
#  --------------------------------------------------------
#

#
# Copy sql script for SQL to update the cost information
#
- name: Deploying SQL Script to update the costs
  template:
    src:  "{{ sql_update_cost_file_name }}"
    dest: "{{ sql_update_cost_script }}"

#
# Generating call for SQL Cost where statement
#
- name: Update the Cost data
  shell: 'export LD_LIBRARY_PATH=/oracle/product/zdmhome/lib && sqlplus -S etc_repository/{{var_etc_repository_password}}@OAITERP @{{ sql_update_cost_script }}'
  register: sql_update_cost_register
  failed_when: "'ORA-' in sql_update_cost_register.stdout"


#
#################################################################
#  Cleanup the working folders
#################################################################

# call the logfile_cleanup role to cleanup the log directory
- name: Calling logfile_cleanup role to cleanup the log directory
  import_role:
    name: logfile_cleanup
  vars:
    path_dir: "{{ working_log_dir }}"

# call the logfile_cleanup role to cleanup the script directory
- name: Calling logfile_cleanup role to cleanup the script directory
  import_role:
    name: logfile_cleanup
  vars:
    path_dir: "{{ working_script_dir }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_cost_updates\tasks\set_facts.yml
#
# set global facts from Survey
#
- name: Setting facts from Survery
  set_fact:
    var_etc_repository_password:    "{{ past_password }}"

#
# Get the Date for report files names
#

- name: Get timestamp from the system to use to format the AWR report file name
  shell: date '+%Y_%m_%d_%H_%M'
  register: tstamp_file_format

- name: Setting facts for the file format date-time
  set_fact:
     var_file_format:                  "{{ tstamp_file_format.stdout }}"



#
# set global facts for Main Directory and Literal Values
#
- name: Setting global facts for main directory
  set_fact:
    working_dir:        "/export/home/oracle/OCPU-DATA"
    save_data_dir:      "/dbutil/oracle/oci/ocpu/data"

#
# set global facts for Folder Literal values
#
- name: Setting Global Facts for Folder Directores
  set_fact:
    working_script_dir:            "{{ working_dir }}/mcu_scripts"
    working_log_dir:               "{{ working_dir }}/mcu_logs"
    #
    sql_oci_file_name:              "extract_oci_call_get_cost_data.sql"
    sql_dates_file_name:            "extract_sql_where_statement_for_dates_data.sql"
    sql_update_cost_file_name:      "update_cost_data_for_the_monthly.sql"
    shell_extract_cost_from_oci:    "extract_oci_data_and_extact_data_json.sh"
    #
    oci_cli_cost_json_log_file:     "oci_cli_json_file.log"
    oci_cli_cost_working_01_file:   "oci_cli_working_file-01.log"
    oci_cli_cost_working_02_file:   "oci_cli_working_file-02.log"
    #
    source_file:                     "/home/oracle"


#
# setting global facts
#
- name: Setting global facts for script and log files
  set_fact:
    sql_oci_script:                    "{{ working_script_dir }}/{{ sql_oci_file_name }}"
    sql_date_script:                   "{{ working_script_dir }}/{{ sql_dates_file_name }}"
    sql_update_cost_script:            "{{ save_data_dir }}/{{var_file_format}}_{{ sql_update_cost_file_name }}"
    shell_cost_extract_script:         "{{ working_script_dir }}/{{ shell_extract_cost_from_oci }}"
    #
    oci_cli_cost_json_log_file_loc:    "{{ working_log_dir }}/{{ oci_cli_cost_json_log_file }}"
    oci_cli_cost_working_file_01_loc:  "{{ working_log_dir }}/{{ oci_cli_cost_working_01_file }}"
    oci_cli_cost_working_file_02_loc:  "{{ working_log_dir }}/{{ oci_cli_cost_working_02_file }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_cost_updates\templates\extract_oci_call_get_cost_data.sql
set serveroutput on size 90000
set feedback off

declare
--
var_current_date              date           := TRUNC(sysdate);
--
var_rpt_date                  date           := TRUNC(var_current_date - 1);
var_rpt_date_eom              date           := TRUNC(last_day( var_current_date - 1));
var_rpt_date_1st_of_the_month date           := trunc(var_current_date -1 , 'mm');
var_rpt_date_tenth_day        date           := trunc(trunc(var_current_date -1, 'mm') + 9);
var_rpt_current_month         varchar2(2)    := to_char(var_current_date -1, 'mm');
--
var_literal_03                varchar2(2)    := '03';
--
var_oci_call_statement_01 varchar2(200)  := ' --time-usage-started ';
var_oci_call_statement_02 varchar2(200)  := ' --time-usage-ended ';
--
begin

--
-- ----------------------------------------------------------------------------------------------
-- Check if the month is March. March has special logic because this is the Oracle contract month.
--     Capture data from 1st-9th  and then 10th-EOM.  There will be two buckets.
--     All of the other months do not need this special logic.
-- ---------------------------------------------------------------------------------------------
--
   If  ( var_rpt_current_month = var_literal_03 )  then
       -- dbms_output.put_line(' debug: Month is March'  );
         --
         -- -----------------------------------------------------------------
         -- Check if the date is less than the 10 day in the month in March
         -- -----------------------------------------------------------------
         --
         If  ( var_rpt_date < var_rpt_date_tenth_day)  then
             -- dbms_output.put_line(' debug: Less than the 10th day in the month'  );
             --
             -- -------------------
             -- Create the OCI Call
             -- -------------------
             --
             dbms_output.put_line( var_oci_call_statement_01 || to_char(var_rpt_date_1st_of_the_month,'yyyy-mm-dd' ) ||  var_oci_call_statement_02 || to_char(var_current_date ,'yyyy-mm-dd' ) );
             --
             -- -------------------
             -- Create the SQL Code
             -- -------------------
             --
         else
             -- dbms_output.put_line(' debug: Greater  or equal to the 10th day in the month'  );
             --
             -- -------------------
             -- Create the OCI Call
             -- -------------------
             --
             dbms_output.put_line( var_oci_call_statement_01 || to_char(var_rpt_date_tenth_day,'yyyy-mm-dd' ) ||  var_oci_call_statement_02 || to_char(var_current_date ,'yyyy-mm-dd' )  );
             --
             -- -------------------
             -- Create the SQL Code
             -- -------------------
             --
         end if;
   else
       -- dbms_output.put_line(' debug: Month is NOT !!!! March'  );
       --
       -- -------------------
       -- Create the OCI Call
       -- -------------------
       --
       dbms_output.put_line( var_oci_call_statement_01 || to_char(var_rpt_date_1st_of_the_month,'yyyy-mm-dd' ) ||  var_oci_call_statement_02 || to_char(var_current_date ,'yyyy-mm-dd' ) );
       --
       -- -------------------
       -- Create the SQL Code
       -- -------------------
       --
   end if;
 end;
/
exit
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_cost_updates\templates\extract_oci_data_and_extact_data_json.sh
#! /bin/bash
#
# Title:        Extract Cost information
# Author:       Jeff Breckenridge
# Date Created: 2024-02-26
# Date Revised: YYYY-MM-DD
# Revision:     1.0
# Purpose:      Extract the Cost information from OCI for a specific time peroid
#
#
# Logic:
# ======
#
#  Use OCI CLI calls to extract the JSON information
#  extract the detail information into insert statements
#  The output information will be used to update the monthly cost information
#
#
# User in OEM to store the data:   etc_repository
# Oracle Database:                 OAITERP
#
#  NOTE:    Pass in the password from the survey. Do not hard Code the password in the Playbooks
#
#
# Working Directores:    /export/home/oracle/OCPU-DATA/logs
#                        /export/home/oracle/OCPU-DATA/scripts
#
# ------------------------------------------------------
# -- OCI CLI Calls:  Extrace Monthly Cost Information --
# ------------------------------------------------------
#
oci usage-api usage-summary request-summarized-usages --granularity MONTHLY {{ sql_oci_data_register_data }} --tenant-id ocid1.tenancy.oc1..aaaaaaaayrq5qewqtyk3y4v7m7u3bkzigb3nghdenvhwenetkaibiyxwxqva   > {{ oci_cli_cost_json_log_file_loc }}
#
# -------------------------------------------------------------------------------
#===============Clean up the JSON file to extract the Cost information ==========
# -------------------------------------------------------------------------------
#
#
cat {{ oci_cli_cost_json_log_file_loc }} | grep -e '"computed-amount":'  > {{ oci_cli_cost_working_file_01_loc }}
#
head -n 1 {{ oci_cli_cost_working_file_01_loc }} > {{ oci_cli_cost_working_file_02_loc }}
#
sed -i 's|"computed-amount":||g'                   {{ oci_cli_cost_working_file_02_loc }}
sed -i 's|,||g'                                    {{ oci_cli_cost_working_file_02_loc }}
sed -i 's|         ||g'                            {{ oci_cli_cost_working_file_02_loc }}
#
# EOF ( End-of_file)

---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_cost_updates\templates\extract_sql_where_statement_for_dates_data.sql
set serveroutput on size 90000
set feedback off
declare
--
var_current_date              date           := TRUNC(sysdate);
--
var_rpt_date                  date           := TRUNC(var_current_date - 1);
var_rpt_date_eom              date           := TRUNC(last_day( var_current_date - 1));
var_rpt_date_1st_of_the_month date           := trunc(var_current_date -1 , 'mm');
var_rpt_date_tenth_day        date           := trunc(trunc(var_current_date -1, 'mm') + 9);
var_rpt_current_month         varchar2(2)    := to_char(var_current_date -1, 'mm');
--
var_literal_03                varchar2(2)    := '03';
--
var_oci_call_statement_01 varchar2(200)  := '  where TRUNC(OCPU_DATE_START) <=  TRUNC(TRUNC(to_date(to_date(''';
var_oci_call_statement_02 varchar2(200)  := ''' , ''yyyy-mm-dd'') )) )  and TRUNC(OCPU_DATE_END) >=  TRUNC(TRUNC(to_date(to_date(''';
var_oci_call_statement_03 varchar2(200)  := ''' , ''yyyy-mm-dd'') )) -1)';
--
begin
--
--
-- ----------------------------------------------------------------------------------------------
-- Check if the month is March. March has special logic because this is the Oracle contract month.
--     Capture data from 1st-9th  and then 10th-EOM.  There will be two buckets.
--     All of the other months do not need this special logic.
-- ---------------------------------------------------------------------------------------------
--
   If  ( var_rpt_current_month = var_literal_03 )  then
       -- dbms_output.put_line(' debug: Month is March'  );
         --
         -- -----------------------------------------------------------------
         -- Check if the date is less than the 10 day in the month in March
         -- -----------------------------------------------------------------
         --
         If  ( var_rpt_date < var_rpt_date_tenth_day)  then
             -- dbms_output.put_line(' debug: Less than the 10th day in the month'  );
             --
             -- -------------------
             -- Create the OCI Call
             -- -------------------
             --
             dbms_output.put_line( var_oci_call_statement_01 || to_char(var_rpt_date_1st_of_the_month,'yyyy-mm-dd' ) ||  var_oci_call_statement_02 || to_char(var_current_date ,'yyyy-mm-dd' ) || var_oci_call_statement_03);
             --
             -- -------------------
             -- Create the SQL Code
             -- -------------------
             --
         else
             -- dbms_output.put_line(' debug: Greater  or equal to the 10th day in the month'  );
             --
             -- -------------------
             -- Create the OCI Call
             -- -------------------
             --
             dbms_output.put_line( var_oci_call_statement_01 || to_char(var_rpt_date_tenth_day,'yyyy-mm-dd' ) ||  var_oci_call_statement_02 || to_char(var_current_date ,'yyyy-mm-dd' ) || var_oci_call_statement_03 );
             --
             -- -------------------
             -- Create the SQL Code
             -- -------------------
             --
         end if;
   else
       -- dbms_output.put_line(' debug: Month is NOT !!!! March'  );
       --
       -- -------------------
       -- Create the OCI Call
       -- -------------------
       --
       dbms_output.put_line( var_oci_call_statement_01 || to_char(var_rpt_date_1st_of_the_month,'yyyy-mm-dd' ) ||  var_oci_call_statement_02 || to_char(var_current_date ,'yyyy-mm-dd' ) || var_oci_call_statement_03);
       --
       -- -------------------
       -- Create the SQL Code
       -- -------------------
       --
   end if;
 end;
/
exit
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_cost_updates\templates\update_cost_data_for_the_monthly.sql
update etc_repository.v_ocpu_monthly_reporting set OCPU_OCI_MONTHLY_VALUE  = {{ cost_data_from_oci }}
{{ sql_date_data_register_data }};
commit;
exit
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_reporting\tasks\main.yml
#
# settings facts
#
- name: Getting facts
  include: set_facts.yml


#
# Make folder for Working Log Directory
#
- name: Creating logs folder if missing
  file:
    path: "{{ working_log_dir }}"
    state: directory
#
# Make folder for Working Scripts Directory
#
- name: Creating script folder if missing
  file:
    path: "{{ working_script_dir }}"
    state: directory


#
# Copy sql script for HTML Reports
#
- name: Deploying SQL Script
  template:
    src:  "{{ sql_file_name_html }}"
    dest: "{{ sql_script_html }}"

#
# Create the OCPU report for HTML format
#
- name: Generating reports
  shell: 'export LD_LIBRARY_PATH=/oracle/product/zdmhome/lib && sqlplus -S etc_repository/{{var_etc_repository_password}}@OAITERP @{{ sql_script_html }}'

- name: Slurp the report file content
  slurp:
    src: "{{ spool_file_html }}"
  register: report_content

#
# send email in HTML format
#

- name: Sending email with reports
  mail:
    host: "{{ smtp_host }}"
    port: 25
    from:      "{{ from_email_address }}"
    to:        "{{ var_email_address_list }}"
    subject:   "{{ email_subject }}"
    subtype: html
    # body: "{{ lookup('file','{{ spool_file_html }}') }}"
    body: "{{ report_content.content | b64decode }}"
#
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_reporting\tasks\set_facts.yml
#
# set global facts from Survey
#
- name: Setting facts from Survery
  set_fact:
    var_email_address_list:         "{{ past_email_address | upper }}"
    var_monthly_max_cost:           "{{ past_monthly_max_cost }}"
    var_etc_repository_password:    "{{ past_password }}"

#
# set global facts for Main Directory and Literal Values
#
- name: Setting global facts for main directory
  set_fact:
    working_dir:        "/export/home/oracle/OCPU-DATA"
    working_dir_report: "/dbutil/oracle/oci/ocpu"

#
# set global facts for Folder Literal values
#
- name: Setting Global Facts for Folder Directores
  set_fact:
    working_log_dir:         "{{ working_dir_report }}/reports"
    working_script_dir:      "{{ working_dir }}/scripts"
    #
    sql_file_name_html:      "generate_monthly_cost_report_html.sql"
    #
    log_file_name_html:      "oci_monthly_cost_report.html"
    #
    source_file:             "/home/oracle"
    #
    from_email_address:      "DLITISOracle@energytransfer.com"
    smtp_host:               "localhost"
    #
    email_subject:           "OCI:  Monthly Cost Report for Y1-4"
    email_body:              "OCI:  Monthly Cost Report for Y1-4"

#
# setting global facts
#
- name: Setting global facts for directories
  set_fact:
    sql_script_html:     "{{ working_script_dir }}/{{sql_file_name_html}}"
    spool_file_html:     "{{ working_log_dir }}/{{log_file_name_html}}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_reporting\templates\generate_monthly_cost_report_html.sql
ET ECHO OFF
SET MARKUP HTML ON SPOOL ON
SET FEEDBACK ON
SET PAGESIZE 2000
alter session set nls_date_format = 'MM/DD/YYYY HH24:MI';


CLEAR COLUMNS
CLEAR COMPUTES
CLEAR TIMING
CLEAR BREAKS


 SET MARKUP HTML ON SPOOL ON PREFORMAT OFF ENTMAP OFF -
 HEAD -
 " -
 <style type=text/css> -
   p { margin:0; padding:0; } -
   table { width:100%; align:left; border:3px solid #998 } -
   th { text-align:center; text-valign:top; font-size:12pt; padding:2px; border:1px #998 solid; background:#bb9; } -
   td { text-valign:top; font-size:12pt; padding:2px; border:1px #998 solid; background:#f2f2f2; } -
 </style> -
 "

column year           format  a20             JUSTIFY CENTER
column days_in_period format  999             JUSTIFY CENTER
column allocated_ucc  format  999,999,999.99  JUSTIFY CENTER
column credit         format  999,999,999.99  JUSTIFY CENTER
column method         format  a20             JUSTIFY CENTER
column START_DATE     format  a15             JUSTIFY CENTER
column END_DATE       format  a15             JUSTIFY CENTER





spool {{ spool_file_html }}


SET TRIMSPOOL ON
SET PAGES 200
SET LINES 250
SET TAB OFF
ALTER SESSION SET TIME_ZONE = DBTIMEZONE;


 SET MARKUP HTML OFF
PROMPT
PROMPT
 PROMPT  <font color="000" align="center" size="9">
PROMPT  Monthly Cost Report for Y1
 PROMPT </font> <br> <font color="998" size="2">
PROMPT <br> The costs are extracted from OCI using CLI
 PROMPT </font>
 SET MARKUP HTML ON


--
-- Date and Monthly Cost --------------------------------------------
--

-- SET MARKUP HTML ENTMAP OFF
-- ROMPT <H2><center><b> Monthly Cost Report for Y1  </b></center></H2>
-- SET MARKUP HTML ENTMAP ON


break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y1'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF

PROMPT <H2><center><b> Monthly Cost Report for Y2  </b></center></H2>
SET MARKUP HTML ENTMAP ON


break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y2'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF

PROMPT <H2><center><b> Monthly Cost Report for Y3  </b></center></H2>
SET MARKUP HTML ENTMAP ON



break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y3'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF


PROMPT <H2><center><b> Monthly Cost Report for Y4  </b></center></H2>
SET MARKUP HTML ENTMAP ON



break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y4'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF

exit;
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_monthly_reporting\templates\bk-generate_monthly_cost_report_html.sql
ET ECHO OFF
SET MARKUP HTML ON SPOOL ON
SET FEEDBACK ON
SET PAGESIZE 2000
alter session set nls_date_format = 'MM/DD/YYYY HH24:MI';


CLEAR COLUMNS
CLEAR COMPUTES
CLEAR TIMING
CLEAR BREAKS


 SET MARKUP HTML ON SPOOL ON PREFORMAT OFF ENTMAP OFF -
 HEAD -
 " -
 <style type=text/css> -
   p { margin:0; padding:0; } -
   table { width:100%; align:left; border:3px solid #998 } -
   th { text-align:center; text-valign:top; font-size:12pt; padding:2px; border:1px #998 solid; background:#bb9; } -
   td { text-valign:top; font-size:12pt; padding:2px; border:1px #998 solid; background:#f2f2f2; } -
 </style> -
 "

column year           format  a20             JUSTIFY CENTER
column days_in_period format  999             JUSTIFY CENTER
column allocated_ucc  format  999,999,999.99  JUSTIFY CENTER
column credit         format  999,999,999.99  JUSTIFY CENTER
column method         format  a20             JUSTIFY CENTER
column START_DATE     format  a15             JUSTIFY CENTER
column END_DATE       format  a15             JUSTIFY CENTER





spool {{ spool_file_html }}


SET TRIMSPOOL ON
SET PAGES 200
SET LINES 250
SET TAB OFF
ALTER SESSION SET TIME_ZONE = DBTIMEZONE;


 SET MARKUP HTML OFF
PROMPT
PROMPT
 PROMPT  <font color="000" align="center" size="9">
PROMPT  Monthly Cost Report for Y1
 PROMPT </font> <br> <font color="998" size="2">
PROMPT <br> The costs are extracted from OCI using CLI
 PROMPT </font>
 SET MARKUP HTML ON


--
-- Date and Monthly Cost --------------------------------------------
--

-- SET MARKUP HTML ENTMAP OFF
-- ROMPT <H2><center><b> Monthly Cost Report for Y1  </b></center></H2>
-- SET MARKUP HTML ENTMAP ON


break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y1'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF

PROMPT <H2><center><b> Monthly Cost Report for Y2  </b></center></H2>
SET MARKUP HTML ENTMAP ON


break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y2'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF

PROMPT <H2><center><b> Monthly Cost Report for Y3  </b></center></H2>
SET MARKUP HTML ENTMAP ON



break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y3'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF


PROMPT <H2><center><b> Monthly Cost Report for Y4  </b></center></H2>
SET MARKUP HTML ENTMAP ON



break on  year skip 3

compute sum label 'Yearly Total:' of "cost"               on year
compute sum label 'Yearly Total:' of "credit"             on year
compute sum label 'Yearly Total:' of "allocated_ucc"      on year
compute sum label 'Total Days:'   of "days_in_period"     on year

select ocpu_year_indicator                        as year,
       to_char(OCPU_DATE_START,'yyyy-mm-dd')      as START_DATE ,
       to_char(OCPU_DATE_END,'yyyy-mm-dd')        as END_DATE,
       ocp_monthly_value                as cost,
      (   to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1              as days_in_period,
      ((( to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} )   as allocated_ucc,
      ((((to_date(to_char(ocpu_date_end,'yyyy-mm-dd'),'yyyy-mm-dd') - to_date(to_char(ocpu_date_start,'yyyy-mm-dd'),'yyyy-mm-dd') ) +1 ) * {{ var_monthly_max_cost }} ) - ocp_monthly_value )   as credit,
       '         ' || ocpu_populate_method  as method
from etc_repository.v_ocpu_monthly_reporting
where ocpu_year_indicator = 'Y4'
order by 1,2 asc;


SET MARKUP HTML ENTMAP OFF

exit;
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_ocpu_reporting\tasks\main.yml
#settings facts
- name: Getting facts
  include: set_facts.yml


#################################################################
#  Verify the directory exists for
#################################################################
-
# create working directory
- name: Creating main directory
  file: path={{ working_dir }} state=directory

# create working directory for logs
- name: Creating main directory for logs
  file: path={{ working_log_dir }} state=directory

# create working directory for scripts
- name: Creating main directory for scripts
  file: path={{ working_script_dir  }} state=directory

# create working directory for save report directory
- name: Creating main directory for the save report directory
  file: path={{ save_report_dir  }} state=directory



#################################################################
#  Copy the .sh script to the server working directory
#################################################################

# copy OCPU script to source
- name: Deploying ocpu Report script
  template:
    src: create_ocpu_report.sh
    dest: "{{ ocpu_report_script_file }}"



#################################################################
#  Run the OCPU Script to create the report and email the results
#################################################################


# execute OCPU Report script
- name: Executing OCI OCPU Report
  shell: "sh {{ ocpu_report_script_file }}"
  ignore_errors: yes


#################################################################
#  Cleanup the working folders
#################################################################

# call the logfile_cleanup role to cleanup the log directory
- name: Calling logfile_cleanup role to cleanup the log directory
  import_role:
    name: logfile_cleanup
  vars:
    path_dir: "{{ working_log_dir }}"

# call the logfile_cleanup role to cleanup the script directory
- name: Calling logfile_cleanup role to cleanup the script directory
  import_role:
    name: logfile_cleanup
  vars:
    path_dir: "{{ working_script_dir }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_ocpu_reporting\tasks\set_facts.yml
- name: Setting facts from Survery
  set_fact:
    var_email_address:                   "{{ past_email_address| upper }}"

# setting facts Literal Values
- name: Setting facts from literal values
  set_fact:
     literal_Not_selected:                 "NOT SELECTED"


#################################################################################################
# Extract the Date-time format for the file AWR format
#################################################################################################

- name: Get timestamp from the system to use to format the AWR report file name
  shell: date '+%Y_%m_%d_%H_%M'
  register: tstamp_file_format

- name: Setting facts for the file format date-time
  set_fact:
     var_file_format:                  "{{ tstamp_file_format.stdout}}"


#################################################################################################
# Set the directory locations
#################################################################################################

# set global facts for Base Values
- name: Setting Global Facts for Base Values
  set_fact:
    working_dir: "/export/home/oracle/OCPU-REPORTS"
    report_name: "{{ var_file_format }}-OCPU-Report-From-OCI.log"

# set global facts for Folder Directores
- name: Setting Global Facts for Folder Directores
  set_fact:
    working_log_dir: "{{ working_dir }}/logs"
    working_script_dir: "{{ working_dir }}/scripts"
    save_report_dir: "/dbutil/oracle/oci/ocpu/reports"

# set global facts for specific files
- name: Setting Global Facts for specific files
  set_fact:
    ocpu_report_script_file: "{{ working_script_dir }}/create_ocpu_report.sh"
    save_report_path_name: "{{ save_report_dir }}/{{ report_name }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_ocpu_reporting\templates\create_ocpu_report.sh
#! /bin/bash
#
# Title:        Create OCPU Report from OCI for all Compartments
# Author:       Jeff Breckenridge
# Date Created: 2024-01-25
# Date Revised: 2024-03-22
# Revision:     2.0
#               2024-03-22:  Add OID Application Servers for Production, Standby and Development
#               2024-06-06:  Add GoldenGate  GG_ETDC_OCI_MIG_DEP - INC000002580502
#
# Purpose:      Extract OCPU information from OCI.
#
#
# Logic:
# ======
#
#  Use OCI CLI calls to extract the JSON information
#  extract the detail information into a report format
#  total the values and send the report via email as an attachment
#
#  This script does not read the OCI tree at the compartment level to get the detail
#  information. This script is hardwired to read the specific child containing the
#  detail information. If any changes are made in OCI then this script will have
#  to be modified to incorporate the updated to OCI.
#
#
# OCPU Information
# =======================
#
#   01). ExaCC  (ExaData Cloud at Customer )  ( Prod, BCC and NonProduction) databases
#   02). Golden Gate
#   03). OKV    (Oracle Key Vault )
#   04). OEM    (Oracle Enterprize Manger ( Instances ( Application) and Databases
#   05). ADB    (Autonomous Databases ) ( Future )
#
#
# #####################################################################
#  Extract Raw data from OCI using CLI Calls----------------------------
# #####################################################################
#
#
# --------------------------------
# -- OCI CLI Calls:  ExaCC Prod --
# --------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aaicjrvblcj3kyjrbftvtacp7vwb2xlyjn6udk4worq5ka  >  {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aamkh6m6m3xpcxwoexjpzfaoyjijz37nybsvdx5kmlwpda  >> {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aastkfknwo3ibvciggohhbheep6wstxyvnzpjzja3kitra  >> {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aavid2bbmujlsmqh665nnqgali25cpmnmhw4wtxzvkgbia  >> {{ working_log_dir }}/exacc-data.output
#
#
#
# ------------------------------------------
# --- OCI CLI Calls: ExaCC non production --
# ------------------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aayfnrj6r7pun45vtrfhdjdyqvgh3bcqurm5sam73kw4jq  >> {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aa7e65frrjgdol4mshj6q7sxdnhacjd2b5wghhd4s4ybua  >> {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aahqckapds76rfbkeqefkcnchlga3ke2lsta5pmy6hquja  >> {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aay3aroazue5bbob2qnvkdbp57cysfxqm35mtnqzkxwmwa  >> {{ working_log_dir }}/exacc-data.output
#
#
#
# -------------------------------
# --- OCI CLI Calls: ExaCC BCC --
# -------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljrtdrro5aaoxht5ie6weduke654cg7pybfpcm6rc3vosu6re4lmdja  >> {{ working_log_dir }}/exacc-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljrtdrro5aale5pwut4vte35hsviyfrgdjkokw42cvvlzqoyrtvxmqq  >> {{ working_log_dir }}/exacc-data.output
#
#
#
# ---------------------------------
# --- OCI CLI Calls: Golden Gate --
# ---------------------------------
#
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aaennzthc3e4poycneuwewavj4ry2e2jqo75b3m3nwxiha >  {{ working_log_dir }}/goldengate-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aav3vnxv32gmc6l7bjaec76onjstnizabkalvsps47fvea >> {{ working_log_dir }}/goldengate-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aahwcykttqvkebpwhf6zwqnbyulj3y6nmdygf4cjt5zptq >> {{ working_log_dir }}/goldengate-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aao4dtgqr6cz76jwvu4jvsi6fa732i6lilh6jdmjyjl3fa >> {{ working_log_dir }}/goldengate-data.output
#
# Added 2024-06-06 for INC000002580502 new object: GG_ETDC_OCI_MIG_DEP
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aaznz4nxl3ld56bxrdnilayeoqesskahafn5o3pkr52flq >> {{ working_log_dir }}/goldengate-data.output
#
#
#
# ------------------------------
# --- OCI CLI Calls: OKV Gate --
# ------------------------------
#
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljttdrro5aciljlqqqmzoxnuar3tzzhh3b32gwgweth5h6lwoxa4bia  >  {{ working_log_dir }}/ovk-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljttdrro5acw2fryzvyimatbohqkqoj4qdxxltwuyhitukcpv6nrqqa  >> {{ working_log_dir }}/ovk-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljstdrro5ac4rh3bxpjipym2y5w4kk2jmzycwh3xnsbe2axt4hfuwvq  >> {{ working_log_dir }}/ovk-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljstdrro5acnxiduvw2namq4oihrdzju2wzkeckerujd7stf4sxbyqa  >> {{ working_log_dir }}/ovk-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljrtdrro5ac44yt552nnm35bqrtxvp3jxfwolvagvka2sghquujii7q  >> {{ working_log_dir }}/ovk-data.output
#
#
#
# -----------------------------------
# --- OCI CLI Calls: OEM instances --
# -----------------------------------
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5ac4elhp7ep3epntn24zkdrxbwmxpzcfqnjer3iodnb36jq >  {{ working_log_dir }}/oem-instances-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5aco76qaqskgehwlr3rxdtdnjncetg7sa6mwgbg6jhihhpa >> {{ working_log_dir }}/oem-instances-data.output
#
#
#
# --------------------------------
# --- OCI CLI Calls: OEM system --
# --------------------------------
#
oci db system         get --db-system-id  ocid1.dbsystem.oc1.iad.anuwcljrtdrro5aaautiempdketxnzvc6caahn3dhyocftiuc3jq3owdak6q  >  {{ working_log_dir }}/oem-system-data.output
oci db system         get --db-system-id  ocid1.dbsystem.oc1.iad.anuwcljstdrro5aa2lrfb3clyr2wldx45vudqp2fzulkosvjuctlf7un5ksa  >> {{ working_log_dir }}/oem-system-data.output
#
#
#
#
# ----------------------------------------------------------------------------
# --- OID CLI Calls: OID instances for Production, Recovery and Development --
# ----------------------------------------------------------------------------
#
# -- production --
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljttdrro5acqmg2pyehc5pznt6qcsevckgwp6j6aivpnoqmo3c4qxxa >   {{ working_log_dir }}/oid-prod-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljttdrro5acql7a5ccic6a4c5c3eqlunu4i3u3z2n5gjqjicjif7nsa >>  {{ working_log_dir }}/oid-prod-instance-data.output
#
#
# -- standby --
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5acy35dsk3crqpifjmwxy63sonhup2a3ua3pyo3tduut4kq >   {{ working_log_dir }}/oid-standby-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5acdsbhjxp45azi7bbjdret4prv6cf5xx645qazaga2exoa >>  {{ working_log_dir }}/oid-standby-instance-data.output
#
#
# -- Development --
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5ack6iysbmdfjbmgbfx4sc3oynofzbilvhcfebm4uojqgha >   {{ working_log_dir }}/oid-development-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5acaj5em2z32ubtjv2kwcdxf7ls2wobgs3lhtgbd54x4wka >>  {{ working_log_dir }}/oid-development-instance-data.output
#




# ########################################################
#  Cleanup the data from JSON format to report format
# ########################################################
#
#
# -------------------------------------
# -- Exacc Cleanup data Cleanup data --
# -------------------------------------
#
cat {{ working_log_dir }}/exacc-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-data.output                    > {{ working_log_dir }}/working-01-exacc-data.output
cat  {{ working_log_dir }}/working-01-exacc-data.output  | awk '{print  $2 , $1  }'   > {{ working_log_dir }}/working-02-exacc-data.output
sort {{ working_log_dir }}/working-02-exacc-data.output                               > {{ working_log_dir }}/working-02-exacc-data-sort.output
#
#
#
#
# -----------------------------------
# -- Golden Gate data Cleanup data --
# -----------------------------------
#
cat {{ working_log_dir }}/goldengate-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-data.output   > {{ working_log_dir }}/working-01-goldengate-data.output
cat  {{ working_log_dir }}/working-01-goldengate-data.output  | awk '{print  $2 , $1  }'   > {{ working_log_dir }}/working-02-goldengate-data.output
sort {{ working_log_dir }}/working-02-goldengate-data.output                               > {{ working_log_dir }}/working-02-goldengate-data-sort.output
#
#
#
# -----------------------------------
# -- OKV Cleanup data Cleanup data --
# -----------------------------------
#
cat {{ working_log_dir }}/ovk-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-data.output
sed -i 's|    "ocpus": ||g'    {{ working_log_dir }}/working-ovk-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-data.output   > {{ working_log_dir }}/working-01-ovk-data.output
sort  {{ working_log_dir }}/working-01-ovk-data.output  > {{ working_log_dir }}/working-02-ovk-data-sort.output
#
#
#
# ----------------------------------------
# ---  OEM instances data Cleanup data ---
# ----------------------------------------
#
cat {{ working_log_dir }}/oem-instances-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oem_instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem_instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oem_instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem_instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem_instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem_instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem_instance-data.output   > {{ working_log_dir }}/working-01-oem-instance-data.output
sort  {{ working_log_dir }}/working-01-oem-instance-data.output             > {{ working_log_dir }}/working-02-oem-instance-data-sort.output
#
#
#
# -------------------------------------
# ---  OEM system data Cleanup data ---
# -------------------------------------
#
cat {{ working_log_dir }}/oem-system-data.output |  grep -e '"display-name":' -e '"cpu-core-count":' > {{ working_log_dir }}/working-oem-system-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-system-data.output
sed -i 's|    "cpu-core-count": ||g'  {{ working_log_dir }}/working-oem-system-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-system-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-system-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-system-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-system-data.output   > {{ working_log_dir }}/working-01-oem-system-data.output
cat  {{ working_log_dir }}/working-01-oem-system-data.output  | awk '{print  $2 , $1  }'   > {{ working_log_dir }}/working-02-oem-system-data.output
sort  {{ working_log_dir }}/working-02-oem-system-data.output  > {{ working_log_dir }}/working-02-oem-system-data-sort.output
#
#
# -----------------------------------------------------
# ---  OID Production Application data Cleanup data ---
# -----------------------------------------------------
#
cat {{ working_log_dir }}/oid-prod-instance-data.output |  grep -e '"display-name":' -e '"ocpus":' > {{ working_log_dir }}/working-oid-prod-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-prod-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-prod-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-prod-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-prod-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-prod-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-prod-instance-data.output   > {{ working_log_dir }}/working-02-oid-prod-instance-data.output
sort  {{ working_log_dir }}/working-02-oid-prod-instance-data.output             > {{ working_log_dir }}/working-02-oid-prod-instance-data-sort.output
#
#
#
# -----------------------------------------------------
# ---  OID Recovery Application data Cleanup data ---
# -----------------------------------------------------
#
cat {{ working_log_dir }}/oid-standby-instance-data.output |  grep -e '"display-name":' -e '"ocpus":' > {{ working_log_dir }}/working-oid-standby-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-standby-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-standby-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-standby-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-standby-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-standby-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-standby-instance-data.output   > {{ working_log_dir }}/working-02-oid-standby-instance-data.output
sort  {{ working_log_dir }}/working-02-oid-standby-instance-data.output             > {{ working_log_dir }}/working-02-oid-standby-instance-data-sort.output
#
#
#
# -----------------------------------------------------
# ---  OID Development Application data Cleanup data ---
# -----------------------------------------------------
#
cat {{ working_log_dir }}/oid-development-instance-data.output |  grep -e '"display-name":' -e '"ocpus":' > {{ working_log_dir }}/working-oid-development-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-development-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-development-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-development-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-development-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-development-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-development-instance-data.output   > {{ working_log_dir }}/working-02-oid-development-instance-data.output
sort  {{ working_log_dir }}/working-02-oid-development-instance-data.output             > {{ working_log_dir }}/working-02-oid-development-instance-data-sort.output
#
#



# ############################################
#  Combine the files to create a report
# ############################################
#
#
cat {{ working_log_dir }}/working-02-exacc-data-sort.output {{ working_log_dir }}/working-02-ovk-data-sort.output {{ working_log_dir }}/working-02-goldengate-data-sort.output   {{ working_log_dir }}/working-02-oem-instance-data-sort.output  {{ working_log_dir }}/working-02-oem-system-data-sort.output {{ working_log_dir }}/working-02-oid-prod-instance-data-sort.output  {{ working_log_dir }}/working-02-oid-standby-instance-data-sort.output  {{ working_log_dir }}/working-02-oid-development-instance-data-sort.output > {{ working_log_dir }}/master-working-03-data.output
#
#
# --Create the Final Totals --
#
# awk '{for(i=1;i<=NF;i++)$i=(a[i]+=$i)}END{print}'  {{ working_log_dir }}/master-working-03-data.output  | awk '{printf  "Total:       %12.2f   ",$2  }'   > {{ working_log_dir }}/master-working-04-data-sorted.output
#
#
#
#
# #####################################
# Create the Body for the email
# #####################################
#
echo " Team, "                                                                   >  {{ working_log_dir }}/email-body.log
echo " "                                                                         >> {{ working_log_dir }}/email-body.log
echo "   Please see the attached file for the OCPU report extracted from OCI."   >> {{ working_log_dir }}/email-body.log
echo " "                                                                         >> {{ working_log_dir }}/email-body.log
echo " "                                                                         >> {{ working_log_dir }}/email-body.log
echo "         Note: The file will be saved in folder  /dbutil/oracle/oci/ocpu/reports   for historical reference"  >> {{ working_log_dir }}/email-body.log
#
#
# ##############################################
# Build the Output for the email Attachment
# ##############################################
#
#
echo " "                                                >  {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " OCPU Report       Date:" `date '+%Y-%m-%d  %r'`  >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
echo "========(ExaCC)================="                 >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-exacc-data-sort.output | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
echo "========(OKV)==================="                 >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-ovk-data-sort.output | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
echo "========(GoldenGATE)==========="                  >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-goldengate-data-sort.output | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
echo "========(OEM)==========="                        >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo "        -----Application-----"                   >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-oem-instance-data-sort.output | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo "        -----Database----"                       >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-oem-system-data-sort.output   | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                                >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
echo "========(OID)==========="                        >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo "        -----Production Application-----"        >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-oid-prod-instance-data-sort.output       | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo "        -----Standby Application----"            >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-oid-standby-instance-data-sort.output     | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo "        -----Development Application-----"       >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
cat {{ working_log_dir }}/working-02-oid-development-instance-data-sort.output | awk '{printf "%30s       %5d \n",  $1,   $2 }' >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                                               >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
echo "========(ADB_Future_State)======"                 >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
echo " "                           >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
awk '{for(i=1;i<=NF;i++)$i=(a[i]+=$i)}END{print}'  {{ working_log_dir }}/master-working-03-data.output  | awk '{printf  "                              Total: %5.f   \n",$2  }'  >> {{ working_log_dir }}/OCPU-Report-From-OCI.log
#
#
# ######################################################
# Copy the OCPU report file to the save directory
# #######################################################
#
cp {{ working_log_dir }}/OCPU-Report-From-OCI.log   {{ save_report_path_name }}
#
#
# ##########################################################
# Email the report
# ##########################################################
#
mutt -s 'OCPU Report from OCI' -a {{ save_report_path_name }} -- {{ var_email_address }}  < {{ working_log_dir }}/email-body.log
#
# ################################
# EOF ( End of the file )
# ################################
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_save_ocpu_data\tasks\main.yml
#settings facts
- name: Getting facts
  include: set_facts.yml


#################################################################
#  Verify the directory exists for
#################################################################
-
# create working directory
- name: Creating main directory
  file: path={{ working_dir }} state=directory

# create working directory for logs
- name: Creating main directory for logs
  file: path={{ working_log_dir }} state=directory

# create working directory for scripts
- name: Creating main directory for scripts
  file: path={{ working_script_dir  }} state=directory

# create working directory for save report directory
- name: Creating main directory for the save report directory
  file: path={{ save_data_dir  }} state=directory



#################################################################
#  Copy the .sh script to the server working directory
#################################################################

# copy OCPU script to source
- name: Deploying ocpu create data script
  template:
    src: insert_ocpu_data_in_oem.sh
    dest: "{{ ocpu_data_script_file }}"



#################################################################
#  Run the OCPU Script to create the report and email the results
#################################################################


# execute OCPU Report script
- name: Executing OCI OCPU capure data script
  shell: "sh {{ ocpu_data_script_file}}"
  ignore_errors: yes


#################################################################
#  Cleanup the working folders
#################################################################

# call the logfile_cleanup role to cleanup the log directory
- name: Calling logfile_cleanup role to cleanup the log directory
  import_role:
    name: logfile_cleanup
  vars:
    path_dir: "{{ working_log_dir }}"

# call the logfile_cleanup role to cleanup the script directory
- name: Calling logfile_cleanup role to cleanup the script directory
  import_role:
    name: logfile_cleanup
  vars:
    path_dir: "{{ working_script_dir }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_save_ocpu_data\tasks\set_facts.yml
- name: Setting facts from Survery
  set_fact:
    var_etc_repository_password:                   "{{ past_password }}"


#################################################################################################
# Extract the Date-time format to use to format the save file data file name
#################################################################################################

- name: Get timestamp from the system to use to format the save file data file name
  shell: date '+%Y_%m_%d_%H_%M'
  register: tstamp_file_format

- name: Setting facts for the file format date-time
  set_fact:
     var_file_format:                  "{{ tstamp_file_format.stdout}}"


#################################################################################################
# Extract the Date-time format to format the to be used in the insert statement
#################################################################################################

- name: Get timestamp from the system to use to format the to be used in the insert statement
  shell: date '+%Y-%m-%d %H:%M'
  register: tstamp_data_format

- name: Setting facts for the file format date-time
  set_fact:
     var_data_format:                  "{{ tstamp_data_format.stdout}}"

#################################################################################################
# Set the directory locations
#################################################################################################

# set global facts for Base Values
- name: Setting Global Facts for Base Values
  set_fact:
    working_dir:       "/export/home/oracle/OCPU-DATA"
    Working_file_name: "{{ var_file_format }}-OCPU-insert_data_to_OEM.sql"

# set global facts for Folder Directores
- name: Setting Global Facts for Folder Directores
  set_fact:
    working_log_dir:    "{{ working_dir }}/logs"
    working_script_dir: "{{ working_dir }}/scripts"
    save_data_dir:      "/dbutil/oracle/oci/ocpu/data"

# set global facts for specific files
- name: Setting Global Facts for specific files
  set_fact:
    ocpu_data_script_file: "{{ working_script_dir }}/insert_ocpu_data_in_oem.sh"
    save_data_path_name: "{{ save_data_dir }}/{{ Working_file_name }}"
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_save_ocpu_data\templates\bk-2024-03-21-insert_ocpu_data_in_oem.sh
#! /bin/bash
#
# Title:        Store the OCPU data in OEM for reporting
# Author:       Jeff Breckenridge
# Date Created: 2024-01-29
# Date Revised: YYYY-MM-DD
# Revision:     1.0
# Purpose:      Extract OCPU information from OCI and store the information in OEM.
#
#
# Logic:
# ======
#
#  Use OCI CLI calls to extract the JSON information
#  extract the detail information into insert statements
#  and store the data in OEM. Save the insert commands
#  incase we have to manualy add them to the database.
#
#
# User in OEM to store the data:   etc_repository
# Oracle Database:                 OAITERP
#
#  NOTE:    Pass in the password from the survey. Do not hard Code the password in the Playbooks
#
#
# Working Directores:    /export/home/oracle/OCPU-DATA/logs
#                        /export/home/oracle/OCPU-DATA/scripts
#
#
#  Save Data Directores:/dbutil/oracle/oci/ocpu/data
#
#
#
# OCPU Information
# =======================
#
#   01). ExaCC  (ExaData Cloud at Customer )  ( Prod, BCC and NonProduction) databases
#   02). Golden Gate
#   03). OKV    (Oracle Key Vault )
#   04). OEM    (Oracle Enterprize Manger ( Instances ( Application) and Databases
#   05). ADB    (Autonomous Databases ) ( Future )
#
#
# Tables/indexes/view created to store the information in OEM
# ============================================================
#
#
# 01). Create the meta data table and load the data
#      ============================================
#
#
#    Create table    etc_repository.ocpu_meta_data
#     ( ocpu_seq			       number primary key,
#       ocpu_Entity_name		       varchar2(200),
#       ocpu_catagory                          varchar2(200) )
#    tablespace ETC_DATA;
#
#
# -- ExaCC --
#
# insert into etc_repository.ocpu_meta_data values ( 1,  'prdcluster1','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 2,  'prdcluster2','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 3,  'prdcluster3','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 4,  'prdcluster4','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 5,  'drcluster1','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 6,  'drcluster2','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 7,  'devcluster1','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 8,  'devcluster2','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 9,  'devcluster3','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 10, 'devcluster4','Exacc');
#
# -- OKV --
#
# insert into etc_repository.ocpu_meta_data values ( 11, 'CETORCXAPOK1P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 12, 'CETORCXAPOK2P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 13, 'CETORCXAPOK3P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 14, 'CETORCXAPOK4P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 15, 'ET-OKV-BK-OLE8-VM','OKV');
#
#
#
# ========(GoldenGATE)===========
#
#
# insert into etc_repository.ocpu_meta_data values ( 16, 'GG_BD_SF_TST_NONREGFCQA_DEP','GoldenGate');
# insert into etc_repository.ocpu_meta_data values ( 17, 'GG_MO_NONREGFC_DEP','GoldenGate');
# insert into etc_repository.ocpu_meta_data values ( 18, 'GG_PROD_NONREG_DEP','GoldenGate');
# insert into etc_repository.ocpu_meta_data values ( 19, 'GG_PROD_SCADA_DEP','GoldenGate');
#
#
#
# ========(OEM)===========
#
#
#     -----Application-----
# insert into etc_repository.ocpu_meta_data values ( 20, 'oe1p','OEM-Application');
# insert into etc_repository.ocpu_meta_data values ( 21, 'oe2p','OEM-Application');
#
#
#       -----Database----
#
# insert into etc_repository.ocpu_meta_data values ( 22, 'oe1p','OEM-Database');
# insert into etc_repository.ocpu_meta_data values ( 23, 'Oe1p_Stdby','OEM-Database');
#

#
# 02). Create the table to store the OCPU data
#      =======================================
#
#  Create table etc_repository.ocpu_tracking_data
#     (	ocpu_entity_name_seq		number,
#        ocpu_value		        number,
#	ocpu_date			date,
#    CONSTRAINT fk_ocpu_entity_name_seq       FOREIGN KEY (ocpu_entity_name_seq) REFERENCES etc_repository.ocpu_meta_data(ocpu_seq))
#    tablespace ETC_DATA;
#
#
#  Create index etc_repository.I_ocpu_tracking_data on etc_repository.ocpu_tracking_data(ocpu_entity_name_seq)   tablespace ETC_DATA;
#
#
# 03). Create the reporting view
#      =========================
#
#  Create or replace view  etc_repository.v_ocpu_reporting AS
#    select  a.ocpu_catagory,
#            a.ocpu_Entity_name,
#            b.ocpu_value,
#            b.ocpu_date
#      from    ocpu_meta_data     a,
#            ocpu_tracking_data b
#    where   b.ocpu_entity_name_seq = a.ocpu_seq;
#
#
# 04). Example of the insert
#      =====================
#
#    insert into  etc_repository.ocpu_tracking_data values (    );
#
#	example: insert into  etc_repository.ocpu_tracking_data values ( 1, 8 , sysdate);
#
#
# 05) Sample Reporting
#     =================
#
#
# set linesize 200
# set pagesize  999
#
# column ocpu_Entity_name format a30
# column ocpu_value format 999999
# column OCPU_DT  format format a30
#
#
# select ocpu_catagory,
#      ocpu_Entity_name,
#      ocpu_value,
#       to_char(ocpu_date,'YYYY-MM-DD HH24:mi') as OCPU_DT
# from   etc_repository.v_ocpu_reporting;
#
#
# select sum(ocpu_value) from etc_repository.v_ocpu_reporting;
#
#
# 06) delete the tracking data ( example )
#     ========================
#
#
#    delete from etc_repository.ocpu_tracking_data;
#    commit;
#
#
#
# --------------------------------
# -- OCI CLI Calls:  ExaCC Prod --
# --------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aastkfknwo3ibvciggohhbheep6wstxyvnzpjzja3kitra  > {{ working_log_dir }}/exacc-prdcluster1-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aaicjrvblcj3kyjrbftvtacp7vwb2xlyjn6udk4worq5ka  > {{ working_log_dir }}/exacc-prdcluster2-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aamkh6m6m3xpcxwoexjpzfaoyjijz37nybsvdx5kmlwpda  > {{ working_log_dir }}/exacc-prdcluster3-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aavid2bbmujlsmqh665nnqgali25cpmnmhw4wtxzvkgbia  > {{ working_log_dir }}/exacc-prdcluster4-data.output
#
#
#
# -------------------------------
# --- OCI CLI Calls: ExaCC BCC --
# -------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljrtdrro5aaoxht5ie6weduke654cg7pybfpcm6rc3vosu6re4lmdja  >  {{ working_log_dir }}/exacc-drcluster1-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljrtdrro5aale5pwut4vte35hsviyfrgdjkokw42cvvlzqoyrtvxmqq  >  {{ working_log_dir }}/exacc-drcluster2-data.output
#
#
#
# ------------------------------------------
# --- OCI CLI Calls: ExaCC non production --
# ------------------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aay3aroazue5bbob2qnvkdbp57cysfxqm35mtnqzkxwmwa  > {{ working_log_dir }}/exacc-devcluster1-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aahqckapds76rfbkeqefkcnchlga3ke2lsta5pmy6hquja  > {{ working_log_dir }}/exacc-devcluster2-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aa7e65frrjgdol4mshj6q7sxdnhacjd2b5wghhd4s4ybua  > {{ working_log_dir }}/exacc-devcluster3-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aayfnrj6r7pun45vtrfhdjdyqvgh3bcqurm5sam73kw4jq  > {{ working_log_dir }}/exacc-devcluster4-data.output
#
#
#
# ------------------------------
# --- OCI CLI Calls: OKV Gate --
# ------------------------------
#
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljttdrro5aciljlqqqmzoxnuar3tzzhh3b32gwgweth5h6lwoxa4bia  > {{ working_log_dir }}/ovk-CETORCXAPOKV01P-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljttdrro5acw2fryzvyimatbohqkqoj4qdxxltwuyhitukcpv6nrqqa  > {{ working_log_dir }}/ovk-CETORCXAPOKV02P-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljstdrro5ac4rh3bxpjipym2y5w4kk2jmzycwh3xnsbe2axt4hfuwvq  > {{ working_log_dir }}/ovk-CETORCXAPOKV03P-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljstdrro5acnxiduvw2namq4oihrdzju2wzkeckerujd7stf4sxbyqa  > {{ working_log_dir }}/ovk-ET-OKV-BK-OLE8-VM-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljrtdrro5ac44yt552nnm35bqrtxvp3jxfwolvagvka2sghquujii7q  > {{ working_log_dir }}/ovk-CETORCXAPOKV04P-data.output
#
#
#
# ---------------------------------
# --- OCI CLI Calls: Golden Gate --
# ---------------------------------
#
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aaennzthc3e4poycneuwewavj4ry2e2jqo75b3m3nwxiha > {{ working_log_dir }}/goldengate-GG_PROD_NONREG_DEP-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aav3vnxv32gmc6l7bjaec76onjstnizabkalvsps47fvea > {{ working_log_dir }}/goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aahwcykttqvkebpwhf6zwqnbyulj3y6nmdygf4cjt5zptq > {{ working_log_dir }}/goldengate-GG_MO_NONREGFC_DEP-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aao4dtgqr6cz76jwvu4jvsi6fa732i6lilh6jdmjyjl3fa > {{ working_log_dir }}/goldengate-GG_PROD_SCADA_DEP-data.output
#
#
#
# -----------------------------------
# --- OCI CLI Calls: OEM instances --
# -----------------------------------
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5ac4elhp7ep3epntn24zkdrxbwmxpzcfqnjer3iodnb36jq >  {{ working_log_dir }}/oem-oem02p-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5aco76qaqskgehwlr3rxdtdnjncetg7sa6mwgbg6jhihhpa > {{ working_log_dir }}/oem-oem01p-instance-data.output
#
#
#
# --------------------------------
# --- OCI CLI Calls: OEM system --
# --------------------------------
#
oci db system         get --db-system-id  ocid1.dbsystem.oc1.iad.anuwcljrtdrro5aaautiempdketxnzvc6caahn3dhyocftiuc3jq3owdak6q  >  {{ working_log_dir }}/oem-oem01p-system-data.output
oci db system         get --db-system-id  ocid1.dbsystem.oc1.iad.anuwcljstdrro5aa2lrfb3clyr2wldx45vudqp2fzulkosvjuctlf7un5ksa  >  {{ working_log_dir }}/oem-oem01p_stdby-system-data.output
#
#
# ########################################################
#  Cleanup the data from JSON format to report format
# ########################################################
#
#
#
#===============ExaCC Prod=============================##
#===============ExaCC Prod=============================##
#===============ExaCC Prod=============================##
#===============ExaCC Prod=============================##
#
# values  ( 1,  'prdcluster1')
# values  ( 2,  'prdcluster2')
# values  ( 3,  'prdcluster3')
# values  ( 4,  'prdcluster4')
#
cat {{ working_log_dir }}/exacc-prdcluster1-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster1-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster1-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster1-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 1," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output
# cat  {{ working_log_dir }}/working-01-exacc-prdcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 1," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output
#
#
#
cat {{ working_log_dir }}/exacc-prdcluster2-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster2-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster2-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster2-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 2," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output
#cat  {{ working_log_dir }}/working-01-exacc-prdcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 2," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output
#
#
#
cat {{ working_log_dir }}/exacc-prdcluster3-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster3-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster3-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster3-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 3," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output
# cat  {{ working_log_dir }}/working-01-exacc-prdcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 3," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output
#
#
#
cat {{ working_log_dir }}/exacc-prdcluster4-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster4-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster4-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster4-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 4," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output
#cat  {{ working_log_dir }}/working-01-exacc-prdcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 4," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output
#
#
#
#================BCC =============================#
#================BCC =============================#
#
# values ( 5,  'drcluster1');
# values ( 6,  'drcluster2');
#
#
cat {{ working_log_dir }}/exacc-drcluster1-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-drcluster1-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-drcluster1-data.output                    > {{ working_log_dir }}/working-exacc-drcluster1-data-data.output
cat  {{ working_log_dir }}/working-exacc-drcluster1-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 5," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster1-data.output
#cat  {{ working_log_dir }}/working-exacc-drcluster1-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 5," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster1-data.output
#
#
#
cat {{ working_log_dir }}/exacc-drcluster2-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-drcluster2-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-drcluster2-data.output                    > {{ working_log_dir }}/working-exacc-drcluster2-data-data.output
cat  {{ working_log_dir }}/working-exacc-drcluster2-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 6," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster2-data.output
#cat  {{ working_log_dir }}/working-exacc-drcluster2-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 6," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster2-data.output
#
#
#
#
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#
# values ( 7,  'devcluster1');
# values ( 8,  'devcluster2');
# values ( 9,  'devcluster3');
# values ( 10, 'devcluster4');
#
#
#
cat {{ working_log_dir }}/exacc-devcluster1-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster1-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster1-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster1-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 7," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster1-data.output
#cat  {{ working_log_dir }}/working-01-exacc-devcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 7," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster1-data.output
#
#
#
cat {{ working_log_dir }}/exacc-devcluster2-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster2-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster2-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster2-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 8," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster2-data.output
#cat  {{ working_log_dir }}/working-01-exacc-devcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 8," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster2-data.output
#
#
#
cat {{ working_log_dir }}/exacc-devcluster3-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster3-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster3-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster3-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 9," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster3-data.output
# cat  {{ working_log_dir }}/working-01-exacc-devcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 9," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster3-data.output
#
#
#
cat {{ working_log_dir }}/exacc-devcluster4-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster4-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster4-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster4-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 10," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster4-data.output
#cat  {{ working_log_dir }}/working-01-exacc-devcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 10," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster4-data.output
#
#
#
# ------------------------------
# --- OKV Gate --
# ------------------------------
#
# values ( 11, 'CETORCXAPOK1P')
# values ( 12, 'CETORCXAPOK2P')
# values ( 13, 'CETORCXAPOK3P')
# values ( 14, 'CETORCXAPOK4P')
# values ( 15, 'ET-OKV-BK-OLE8-VM')
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV01P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV01P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV01P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 11," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output
#cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV01P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 11," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV02P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV02P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV02P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 12," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output
# cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV02P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 12," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV03P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV03P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV03P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 13," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output
# cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV03P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 13," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV04P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV04P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV04P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 14," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output
# cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV04P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 14," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-ET-OKV-BK-OLE8-VM-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output  > {{ working_log_dir }}/working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
cat   {{ working_log_dir }}/working-01-ovk-ET-OKV-BK-OLE8-VM-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 15," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'  > {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
# cat   {{ working_log_dir }}/working-01-ovk-ET-OKV-BK-OLE8-VM-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 15," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
#
# ------------------
# --- Golden Gate --
# ------------------
#
# values ( 16, 'GG_BD_SF_TST_NONREGFCQA_DEP');
# values ( 17, 'GG_MO_NONREGFC_DEP');
# values ( 18, 'GG_PROD_NONREG_DEP');
# values ( 19, 'GG_PROD_SCADA_DEP');
#
#
#
cat {{ working_log_dir }}/goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 16," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
# cat   {{ working_log_dir }}/working-01-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 16," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
#
#
#
cat {{ working_log_dir }}/goldengate-GG_MO_NONREGFC_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_MO_NONREGFC_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_MO_NONREGFC_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 17," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output
# cat   {{ working_log_dir }}/working-01-goldengate-GG_MO_NONREGFC_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 17," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output
#
#
#
cat {{ working_log_dir }}/goldengate-GG_PROD_NONREG_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_PROD_NONREG_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_NONREG_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 18," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output
# cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_NONREG_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 18," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output
#
#
cat {{ working_log_dir }}/goldengate-GG_PROD_SCADA_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_PROD_SCADA_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_SCADA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 19," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output
#cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_SCADA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 19," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output
#
#
# ----------------------------------------
# ---  OEM instances --- "APPLICATION"
# ----------------------------------------
#
# values ( 20, 'oe1p');
# values ( 21, 'oe2p');
#
cat {{ working_log_dir }}/oem-oem01p-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem01p-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem01p-instance-data.output   > {{ working_log_dir }}/working-01-oem-oem01p-instance-data.output
cat   {{ working_log_dir }}/working-01-oem-oem01p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 20," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem01p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 20," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output
#
#
#
cat {{ working_log_dir }}/oem-oem02p-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem02p-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem02p-instance-data.output   > {{ working_log_dir }}/working-01-oem-oem02p-instance-data.output
cat   {{ working_log_dir }}/working-01-oem-oem02p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 21," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem02p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 21," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output
#
#
#
# ---------------------
# ---  OEM database ---
# ---------------------
# values ( 22, 'oe1p');
# values ( 23, 'Oe1p_Stdby');
#
# -------------------------------------
# ---  OEM system data Cleanup data ---
# -------------------------------------
#
#
cat {{ working_log_dir }}/oem-oem01p-system-data.output |  grep -e '"display-name":' -e '"cpu-core-count":' > {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|    "cpu-core-count": ||g'  {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem01p-system-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem01p-system-data.output  > {{ working_log_dir }}/working-01-oem-oem01p-system-data.output
cat   {{ working_log_dir }}/working-01-oem-oem01p-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 22," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-system-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem01p-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 22," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-system-data.output
#
#
cat {{ working_log_dir }}/oem-oem01p_stdby-system-data.output |  grep -e '"display-name":' -e '"cpu-core-count":' > {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|    "cpu-core-count": ||g'  {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output  > {{ working_log_dir }}/working-01-oem-oem01p_stdby-system-data.output
cat   {{ working_log_dir }}/working-01-oem-oem01p_stdby-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 23," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem01p_stdby-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 23," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output
#
#
#
# ---------------------------------------------------
# ---  Combine the file to create the insert file  --
# ---------------------------------------------------
#
# -----------
# ---ExaCC ---
# -----------
#
#
# ------------------
# --- production ---
# ------------------
#
#  1  {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output
#  2  {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output
#  3  {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output
#  4  {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output
#
# -----------
# --- bcc ---
# -----------
#
#  5  {{ working_log_dir }}/working-02-exacc-drcluster1-data.output
#  6  {{ working_log_dir }}/working-02-exacc-drcluster2-data.output
#
# ---------------------
# --- nonproduction ---
# ---------------------
#
#  7  {{ working_log_dir }}/working-02-exacc-devcluster1-data.output
#  8  {{ working_log_dir }}/working-02-exacc-devcluster2-data.output
#  9  {{ working_log_dir }}/working-02-exacc-devcluster3-data.output
# 10  {{ working_log_dir }}/working-02-exacc-devcluster4-data.output
#
# -----------
# --- OVK ---
# -----------
#
#
# 11  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output
# 12  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output
# 13  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output
# 14  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output
# 15  {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
#
#
# ------------------
# --- GoldenGate ---
# ------------------
#
# 16  {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
# 17  {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output
# 18  {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output
# 19  {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output
#
# ---------
# -- OEM --
# ---------
#
# 20  {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output
# 21  {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output
# 22  {{ working_log_dir }}/working-02-oem-oem01p-system-data.output
# 23  {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output
#
#
# ------------------------
# --- ExaCC Production ---
# ------------------------
#
#
cat  {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output                    >  {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output                    >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output                    >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output                    >> {{ working_log_dir }}/working-inserts.output
#
# -----------------
# --- ExaCC bcc ---
# -----------------
#
#
cat  {{ working_log_dir }}/working-02-exacc-drcluster1-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-drcluster2-data.output                      >> {{ working_log_dir }}/working-inserts.output
#
# ---------------------------
# --- ExaCC nonproduction ---
# ---------------------------
#
#
cat  {{ working_log_dir }}/working-02-exacc-devcluster1-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-devcluster2-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-devcluster3-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-devcluster4-data.output                      >> {{ working_log_dir }}/working-inserts.output
#
#
# -----------
# --- OVK ---
# -----------
#
#
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output        >> {{ working_log_dir }}/working-inserts.output
#
#
# ------------------
# --- GoldenGate ---
# ------------------
#
#
cat  {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output  >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output           >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output           >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output            >> {{ working_log_dir }}/working-inserts.output
#
# ---------
# -- OEM --
# ---------
#
cat  {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oem-oem01p-system-data.output                       >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output                 >> {{ working_log_dir }}/working-inserts.output
#
#
echo 'commit;'   >> {{ working_log_dir }}/working-inserts.output
echo 'exit'      >> {{ working_log_dir }}/working-inserts.output
#
#
#
#
# ----------------------------------------------
# ---  Save the file for historcal reference  --
# ----------------------------------------------
#
cp -p {{ working_log_dir }}/working-inserts.output {{ save_data_path_name }}
#
#
#
# --------------------------------------------
# ---  Load the data into the OEM database  --
# --------------------------------------------
#
export LD_LIBRARY_PATH="/oracle/product/zdmhome/lib"
#
sqlplus -s etc_repository/{{var_etc_repository_password}}@OAITERP  @{{ working_log_dir }}/working-inserts.output
#
#
# EOF ( End-of-File)
---------------------------------------------------------------------------------------------------------------------------------------
----roles\oci_save_ocpu_data\templates\insert_ocpu_data_in_oem.sh
#! /bin/bash
#
# Title:        Store the OCPU data in OEM for reporting
# Author:       Jeff Breckenridge
# Date Created: 2024-01-29
# Date Revised: 2024-03-21
# Revision:     2.0
# Purpose:      Extract OCPU information from OCI and store the information in OEM.
#
# Revisions:   2024-03-21:     OID servers (production, recovery and development) added on 2024-03-18
#              2024-06-06:     GoldenGate new object: GG_ETDC_OCI_MIG_DEP using INC000002580502
#
# Logic:
# ======
#
#  Use OCI CLI calls to extract the JSON information
#  extract the detail information into insert statements
#  and store the data in OEM. Save the insert commands
#  incase we have to manualy add them to the database.
#
#
# User in OEM to store the data:   etc_repository
# Oracle Database:                 OAITERP
#
#  NOTE:    Pass in the password from the survey. Do not hard Code the password in the Playbooks
#
#
# Working Directores:    /export/home/oracle/OCPU-DATA/logs
#                        /export/home/oracle/OCPU-DATA/scripts
#
#
#  Save Data Directores:/dbutil/oracle/oci/ocpu/data
#
#
#
# OCPU Information
# =======================
#
#   01). ExaCC  (ExaData Cloud at Customer )  ( Prod, BCC and NonProduction) databases
#   02). Golden Gate
#   03). OKV    (Oracle Key Vault )
#   04). OEM    (Oracle Enterprize Manger ( Instances ( Application) and Databases
#   05). ADB    (Autonomous Databases ) ( Future )
#   06). OID    (production, recovery and development) (compute) (instances)   added on 2024-03-18
#
#
# Tables/indexes/view created to store the information in OEM
# ============================================================
#
#
# 01). Create the meta data table and load the data
#      ============================================
#
#
#    Create table    etc_repository.ocpu_meta_data
#     ( ocpu_seq			       number primary key,
#       ocpu_Entity_name		       varchar2(200),
#       ocpu_catagory                          varchar2(200) )
#    tablespace ETC_DATA;
#
#
# -- ExaCC --
#
# insert into etc_repository.ocpu_meta_data values ( 1,  'prdcluster1','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 2,  'prdcluster2','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 3,  'prdcluster3','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 4,  'prdcluster4','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 5,  'drcluster1','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 6,  'drcluster2','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 7,  'devcluster1','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 8,  'devcluster2','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 9,  'devcluster3','Exacc');
# insert into etc_repository.ocpu_meta_data values ( 10, 'devcluster4','Exacc');
#
# -- OKV --
#
# insert into etc_repository.ocpu_meta_data values ( 11, 'CETORCXAPOK1P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 12, 'CETORCXAPOK2P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 13, 'CETORCXAPOK3P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 14, 'CETORCXAPOK4P','OKV');
# insert into etc_repository.ocpu_meta_data values ( 15, 'ET-OKV-BK-OLE8-VM','OKV');
#
#
#
# ========(GoldenGATE)===========
#
#
# insert into etc_repository.ocpu_meta_data values ( 16, 'GG_BD_SF_TST_NONREGFCQA_DEP','GoldenGate');
# insert into etc_repository.ocpu_meta_data values ( 17, 'GG_MO_NONREGFC_DEP','GoldenGate');
# insert into etc_repository.ocpu_meta_data values ( 18, 'GG_PROD_NONREG_DEP','GoldenGate');
# insert into etc_repository.ocpu_meta_data values ( 19, 'GG_PROD_SCADA_DEP','GoldenGate');
#
# insert into etc_repository.ocpu_meta_data values ( 30, 'GG_ETDC_OCI_MIG_DEP','GoldenGate');
#
#
# ========(OEM)===========
#
#
#     -----Application-----
# insert into etc_repository.ocpu_meta_data values ( 20, 'oe1p','OEM-Application');
# insert into etc_repository.ocpu_meta_data values ( 21, 'oe2p','OEM-Application');
#
#
#       -----Database----
#
# insert into etc_repository.ocpu_meta_data values ( 22, 'oe1p','OEM-Database');
# insert into etc_repository.ocpu_meta_data values ( 23, 'Oe1p_Stdby','OEM-Database');
#
#
#
# ========(OID)=========== (added 2024-04-18)
#
#
#     -----Application-----
#
# insert into etc_repository.ocpu_meta_data values ( 24, 'oid01p','OID-Application');
# insert into etc_repository.ocpu_meta_data values ( 25, 'oid02p','OID-Application');
#
# insert into etc_repository.ocpu_meta_data values ( 26, 'oid01r','OID-R-Application');
# insert into etc_repository.ocpu_meta_data values ( 27, 'oid02r','OID-R-Application');
#
#
#     -----Dev Application-----
#
# insert into etc_repository.ocpu_meta_data values ( 28, 'oid01d','OID-Dev-Application');
# insert into etc_repository.ocpu_meta_data values ( 29, 'oid02d','OID-Dev-Application');
#



#
# 02). Create the table to store the OCPU data
#      =======================================
#
#  Create table etc_repository.ocpu_tracking_data
#     (	ocpu_entity_name_seq		number,
#        ocpu_value		        number,
#	ocpu_date			date,
#    CONSTRAINT fk_ocpu_entity_name_seq       FOREIGN KEY (ocpu_entity_name_seq) REFERENCES etc_repository.ocpu_meta_data(ocpu_seq))
#    tablespace ETC_DATA;
#
#
#  Create index etc_repository.I_ocpu_tracking_data on etc_repository.ocpu_tracking_data(ocpu_entity_name_seq)   tablespace ETC_DATA;
#
#
# 03). Create the reporting view
#      =========================
#
#  Create or replace view  etc_repository.v_ocpu_reporting AS
#    select  a.ocpu_catagory,
#            a.ocpu_Entity_name,
#            b.ocpu_value,
#            b.ocpu_date
#      from    ocpu_meta_data     a,
#            ocpu_tracking_data b
#    where   b.ocpu_entity_name_seq = a.ocpu_seq;
#
#
# 04). Example of the insert
#      =====================
#
#    insert into  etc_repository.ocpu_tracking_data values (    );
#
#	example: insert into  etc_repository.ocpu_tracking_data values ( 1, 8 , sysdate);
#
#
# 05) Sample Reporting
#     =================
#
#
# set linesize 200
# set pagesize  999
#
# column ocpu_Entity_name format a30
# column ocpu_value format 999999
# column OCPU_DT  format format a30
#
#
# select ocpu_catagory,
#      ocpu_Entity_name,
#      ocpu_value,
#       to_char(ocpu_date,'YYYY-MM-DD HH24:mi') as OCPU_DT
# from   etc_repository.v_ocpu_reporting;
#
#
# select sum(ocpu_value) from etc_repository.v_ocpu_reporting;
#
#
# 06) delete the tracking data ( example )
#     ========================
#
#
#    delete from etc_repository.ocpu_tracking_data;
#    commit;
#
#
#
# --------------------------------
# -- OCI CLI Calls:  ExaCC Prod --
# --------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aastkfknwo3ibvciggohhbheep6wstxyvnzpjzja3kitra  > {{ working_log_dir }}/exacc-prdcluster1-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aaicjrvblcj3kyjrbftvtacp7vwb2xlyjn6udk4worq5ka  > {{ working_log_dir }}/exacc-prdcluster2-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aamkh6m6m3xpcxwoexjpzfaoyjijz37nybsvdx5kmlwpda  > {{ working_log_dir }}/exacc-prdcluster3-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aavid2bbmujlsmqh665nnqgali25cpmnmhw4wtxzvkgbia  > {{ working_log_dir }}/exacc-prdcluster4-data.output
#
#
#
# -------------------------------
# --- OCI CLI Calls: ExaCC BCC --
# -------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljrtdrro5aaoxht5ie6weduke654cg7pybfpcm6rc3vosu6re4lmdja  >  {{ working_log_dir }}/exacc-drcluster1-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljrtdrro5aale5pwut4vte35hsviyfrgdjkokw42cvvlzqoyrtvxmqq  >  {{ working_log_dir }}/exacc-drcluster2-data.output
#
#
#
# ------------------------------------------
# --- OCI CLI Calls: ExaCC non production --
# ------------------------------------------
#
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aay3aroazue5bbob2qnvkdbp57cysfxqm35mtnqzkxwmwa  > {{ working_log_dir }}/exacc-devcluster1-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aahqckapds76rfbkeqefkcnchlga3ke2lsta5pmy6hquja  > {{ working_log_dir }}/exacc-devcluster2-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aa7e65frrjgdol4mshj6q7sxdnhacjd2b5wghhd4s4ybua  > {{ working_log_dir }}/exacc-devcluster3-data.output
oci db vm-cluster get --vm-cluster-id  ocid1.vmcluster.oc1.iad.anuwcljttdrro5aayfnrj6r7pun45vtrfhdjdyqvgh3bcqurm5sam73kw4jq  > {{ working_log_dir }}/exacc-devcluster4-data.output
#
#
#
# ------------------------------
# --- OCI CLI Calls: OKV Gate --
# ------------------------------
#
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljttdrro5aciljlqqqmzoxnuar3tzzhh3b32gwgweth5h6lwoxa4bia  > {{ working_log_dir }}/ovk-CETORCXAPOKV01P-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljttdrro5acw2fryzvyimatbohqkqoj4qdxxltwuyhitukcpv6nrqqa  > {{ working_log_dir }}/ovk-CETORCXAPOKV02P-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljstdrro5ac4rh3bxpjipym2y5w4kk2jmzycwh3xnsbe2axt4hfuwvq  > {{ working_log_dir }}/ovk-CETORCXAPOKV03P-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljstdrro5acnxiduvw2namq4oihrdzju2wzkeckerujd7stf4sxbyqa  > {{ working_log_dir }}/ovk-ET-OKV-BK-OLE8-VM-data.output
oci compute instance get  --instance-id   ocid1.instance.oc1.iad.anuwcljrtdrro5ac44yt552nnm35bqrtxvp3jxfwolvagvka2sghquujii7q  > {{ working_log_dir }}/ovk-CETORCXAPOKV04P-data.output
#
#
#
# ---------------------------------
# --- OCI CLI Calls: Golden Gate --
# ---------------------------------
#
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aaennzthc3e4poycneuwewavj4ry2e2jqo75b3m3nwxiha > {{ working_log_dir }}/goldengate-GG_PROD_NONREG_DEP-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aav3vnxv32gmc6l7bjaec76onjstnizabkalvsps47fvea > {{ working_log_dir }}/goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aahwcykttqvkebpwhf6zwqnbyulj3y6nmdygf4cjt5zptq > {{ working_log_dir }}/goldengate-GG_MO_NONREGFC_DEP-data.output
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aao4dtgqr6cz76jwvu4jvsi6fa732i6lilh6jdmjyjl3fa > {{ working_log_dir }}/goldengate-GG_PROD_SCADA_DEP-data.output
#
# Add   2024-06-06:  Add GoldenGate  GG_ETDC_OCI_MIG_DEP - INC000002580502
oci goldengate deployment get  --deployment-id  ocid1.goldengatedeployment.oc1.iad.amaaaaaatdrro5aaznz4nxl3ld56bxrdnilayeoqesskahafn5o3pkr52flq > {{ working_log_dir }}/goldengate-GG_ETDC_OCI_MIG_DEP-data.output
#
#
#
# -----------------------------------
# --- OCI CLI Calls: OEM instances --
# -----------------------------------
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5ac4elhp7ep3epntn24zkdrxbwmxpzcfqnjer3iodnb36jq >  {{ working_log_dir }}/oem-oem02p-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5aco76qaqskgehwlr3rxdtdnjncetg7sa6mwgbg6jhihhpa > {{ working_log_dir }}/oem-oem01p-instance-data.output
#
#
#
# --------------------------------
# --- OCI CLI Calls: OEM system --
# --------------------------------
#
oci db system         get --db-system-id  ocid1.dbsystem.oc1.iad.anuwcljrtdrro5aaautiempdketxnzvc6caahn3dhyocftiuc3jq3owdak6q  >  {{ working_log_dir }}/oem-oem01p-system-data.output
oci db system         get --db-system-id  ocid1.dbsystem.oc1.iad.anuwcljstdrro5aa2lrfb3clyr2wldx45vudqp2fzulkosvjuctlf7un5ksa  >  {{ working_log_dir }}/oem-oem01p_stdby-system-data.output
#
#
#
# ----------------------------------------------------------------------------
# --- OID CLI Calls: OID instances for Production, Recovery and Development --
# ----------------------------------------------------------------------------
#
# -- production --
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljttdrro5acqmg2pyehc5pznt6qcsevckgwp6j6aivpnoqmo3c4qxxa >  {{ working_log_dir }}/oid-oid01p-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljttdrro5acql7a5ccic6a4c5c3eqlunu4i3u3z2n5gjqjicjif7nsa >  {{ working_log_dir }}/oid-oid02p-instance-data.output
#
#
# -- recovery --
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5acy35dsk3crqpifjmwxy63sonhup2a3ua3pyo3tduut4kq >  {{ working_log_dir }}/oid-oid01r-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljstdrro5acdsbhjxp45azi7bbjdret4prv6cf5xx645qazaga2exoa >  {{ working_log_dir }}/oid-oid02r-instance-data.output
#
#
# -- Development --
#
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5ack6iysbmdfjbmgbfx4sc3oynofzbilvhcfebm4uojqgha >  {{ working_log_dir }}/oid-oid01d-instance-data.output
oci compute instance  get --instance-id  ocid1.instance.oc1.iad.anuwcljrtdrro5acaj5em2z32ubtjv2kwcdxf7ls2wobgs3lhtgbd54x4wka >  {{ working_log_dir }}/oid-oid02d-instance-data.output
#




# ########################################################
#  Cleanup the data from JSON format to report format
# ########################################################
#
#
#
#===============ExaCC Prod=============================##
#===============ExaCC Prod=============================##
#===============ExaCC Prod=============================##
#===============ExaCC Prod=============================##
#
# values  ( 1,  'prdcluster1')
# values  ( 2,  'prdcluster2')
# values  ( 3,  'prdcluster3')
# values  ( 4,  'prdcluster4')
#
cat {{ working_log_dir }}/exacc-prdcluster1-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster1-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster1-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster1-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster1-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 1," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output
# cat  {{ working_log_dir }}/working-01-exacc-prdcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 1," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output
#
#
#
cat {{ working_log_dir }}/exacc-prdcluster2-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster2-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster2-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster2-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster2-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 2," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output
#cat  {{ working_log_dir }}/working-01-exacc-prdcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 2," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output
#
#
#
cat {{ working_log_dir }}/exacc-prdcluster3-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster3-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster3-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster3-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster3-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 3," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output
# cat  {{ working_log_dir }}/working-01-exacc-prdcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 3," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output
#
#
#
cat {{ working_log_dir }}/exacc-prdcluster4-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-prdcluster4-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-prdcluster4-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-prdcluster4-data.output                    > {{ working_log_dir }}/working-01-exacc-prdcluster4-data.output
cat  {{ working_log_dir }}/working-01-exacc-prdcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 4," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output
#cat  {{ working_log_dir }}/working-01-exacc-prdcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 4," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output
#
#
#
#================BCC =============================#
#================BCC =============================#
#
# values ( 5,  'drcluster1');
# values ( 6,  'drcluster2');
#
#
cat {{ working_log_dir }}/exacc-drcluster1-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-drcluster1-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-drcluster1-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-drcluster1-data.output                    > {{ working_log_dir }}/working-exacc-drcluster1-data-data.output
cat  {{ working_log_dir }}/working-exacc-drcluster1-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 5," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster1-data.output
#cat  {{ working_log_dir }}/working-exacc-drcluster1-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 5," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster1-data.output
#
#
#
cat {{ working_log_dir }}/exacc-drcluster2-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-drcluster2-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-drcluster2-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-drcluster2-data.output                    > {{ working_log_dir }}/working-exacc-drcluster2-data-data.output
cat  {{ working_log_dir }}/working-exacc-drcluster2-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 6," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster2-data.output
#cat  {{ working_log_dir }}/working-exacc-drcluster2-data-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 6," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-drcluster2-data.output
#
#
#
#
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#===============ExaCC NONProd=============================##
#
# values ( 7,  'devcluster1');
# values ( 8,  'devcluster2');
# values ( 9,  'devcluster3');
# values ( 10, 'devcluster4');
#
#
#
cat {{ working_log_dir }}/exacc-devcluster1-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster1-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster1-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster1-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster1-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 7," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster1-data.output
#cat  {{ working_log_dir }}/working-01-exacc-devcluster1-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 7," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster1-data.output
#
#
#
cat {{ working_log_dir }}/exacc-devcluster2-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster2-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster2-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster2-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster2-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 8," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster2-data.output
#cat  {{ working_log_dir }}/working-01-exacc-devcluster2-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 8," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster2-data.output
#
#
#
cat {{ working_log_dir }}/exacc-devcluster3-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster3-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster3-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster3-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster3-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 9," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster3-data.output
# cat  {{ working_log_dir }}/working-01-exacc-devcluster3-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 9," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster3-data.output
#
#
#
cat {{ working_log_dir }}/exacc-devcluster4-data.output |  grep -e '"display-name":' -e '"cpus-enabled":'  > {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|    "cpus-enabled": ||g'    {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-exacc-devcluster4-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-exacc-devcluster4-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-exacc-devcluster4-data.output                    > {{ working_log_dir }}/working-01-exacc-devcluster4-data.output
cat  {{ working_log_dir }}/working-01-exacc-devcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 10," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster4-data.output
#cat  {{ working_log_dir }}/working-01-exacc-devcluster4-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 10," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-exacc-devcluster4-data.output
#
#
#
# ------------------------------
# --- OKV Gate --
# ------------------------------
#
# values ( 11, 'CETORCXAPOK1P')
# values ( 12, 'CETORCXAPOK2P')
# values ( 13, 'CETORCXAPOK3P')
# values ( 14, 'CETORCXAPOK4P')
# values ( 15, 'ET-OKV-BK-OLE8-VM')
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV01P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV01P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV01P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV01P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 11," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output
#cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV01P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 11," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV02P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV02P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV02P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV02P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 12," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output
# cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV02P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 12," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV03P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV03P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV03P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV03P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 13," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output
# cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV03P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 13," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-CETORCXAPOKV04P-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-CETORCXAPOKV04P-data.output  > {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV04P-data.output
cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV04P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 14," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output
# cat   {{ working_log_dir }}/working-01-ovk-CETORCXAPOKV04P-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 14," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output
#
#
#
cat {{ working_log_dir }}/ovk-ET-OKV-BK-OLE8-VM-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-ovk-ET-OKV-BK-OLE8-VM-data.output  > {{ working_log_dir }}/working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
cat   {{ working_log_dir }}/working-01-ovk-ET-OKV-BK-OLE8-VM-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 15," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'  > {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
# cat   {{ working_log_dir }}/working-01-ovk-ET-OKV-BK-OLE8-VM-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 15," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
#
# ------------------
# --- Golden Gate --
# ------------------
#
# values ( 16, 'GG_BD_SF_TST_NONREGFCQA_DEP');
# values ( 17, 'GG_MO_NONREGFC_DEP');
# values ( 18, 'GG_PROD_NONREG_DEP');
# values ( 19, 'GG_PROD_SCADA_DEP');
# values ( 30, 'GG_ETDC_OCI_MIG_DEP')
#
#
#
cat {{ working_log_dir }}/goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 16," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
# cat   {{ working_log_dir }}/working-01-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 16," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
#
#
#
cat {{ working_log_dir }}/goldengate-GG_MO_NONREGFC_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_MO_NONREGFC_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_MO_NONREGFC_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_MO_NONREGFC_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 17," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output
# cat   {{ working_log_dir }}/working-01-goldengate-GG_MO_NONREGFC_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 17," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output
#
#
#
cat {{ working_log_dir }}/goldengate-GG_PROD_NONREG_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_PROD_NONREG_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_PROD_NONREG_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_NONREG_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 18," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output
# cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_NONREG_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 18," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output
#
#
cat {{ working_log_dir }}/goldengate-GG_PROD_SCADA_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_PROD_SCADA_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_PROD_SCADA_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_SCADA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 19," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output
#cat   {{ working_log_dir }}/working-01-goldengate-GG_PROD_SCADA_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 19," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output
#
#
# GG_ETDC_OCI_MIG_DEP - 30
#
cat {{ working_log_dir }}/goldengate-GG_ETDC_OCI_MIG_DEP-data.output |  grep -e '"deployment-name": ' -e '"cpu-core-count": '  > {{ working_log_dir }}/working-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
sed -i 's|    "deployment-name": "||g' {{ working_log_dir }}/working-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
sed -i 's|    "cpu-core-count": ||g'   {{ working_log_dir }}/working-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
sed -i 's|",||g'                       {{ working_log_dir }}/working-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
sed -i 's|,||g'                        {{ working_log_dir }}/working-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-goldengate-GG_ETDC_OCI_MIG_DEP-data.output   > {{ working_log_dir }}/working-01-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
cat   {{ working_log_dir }}/working-01-goldengate-GG_ETDC_OCI_MIG_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 30," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
#cat   {{ working_log_dir }}/working-01-goldengate-GG_ETDC_OCI_MIG_DEP-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 30," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
#
#
# ----------------------------------------
# ---  OEM instances --- "APPLICATION"
# ----------------------------------------
#
# values ( 20, 'oe1p');
# values ( 21, 'oe2p');
#
cat {{ working_log_dir }}/oem-oem01p-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem01p-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem01p-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem01p-instance-data.output   > {{ working_log_dir }}/working-01-oem-oem01p-instance-data.output
cat   {{ working_log_dir }}/working-01-oem-oem01p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 20," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem01p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 20," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output
#
#
#
cat {{ working_log_dir }}/oem-oem02p-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem02p-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem02p-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem02p-instance-data.output   > {{ working_log_dir }}/working-01-oem-oem02p-instance-data.output
cat   {{ working_log_dir }}/working-01-oem-oem02p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 21," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem02p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 21," , $2 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output
#
#
#
# ---------------------
# ---  OEM database ---
# ---------------------
# values ( 22, 'oe1p');
# values ( 23, 'Oe1p_Stdby');
#
# -------------------------------------
# ---  OEM system data Cleanup data ---
# -------------------------------------
#
#
cat {{ working_log_dir }}/oem-oem01p-system-data.output |  grep -e '"display-name":' -e '"cpu-core-count":' > {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|    "cpu-core-count": ||g'  {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem01p-system-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem01p-system-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem01p-system-data.output  > {{ working_log_dir }}/working-01-oem-oem01p-system-data.output
cat   {{ working_log_dir }}/working-01-oem-oem01p-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 22," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-system-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem01p-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 22," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p-system-data.output
#
#
cat {{ working_log_dir }}/oem-oem01p_stdby-system-data.output |  grep -e '"display-name":' -e '"cpu-core-count":' > {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|    "cpu-core-count": ||g'  {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oem-oem01p_stdby-system-data.output  > {{ working_log_dir }}/working-01-oem-oem01p_stdby-system-data.output
cat   {{ working_log_dir }}/working-01-oem-oem01p_stdby-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 23," , $1 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output
# cat   {{ working_log_dir }}/working-01-oem-oem01p_stdby-system-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 23," , $1 , ",to_date('{{ var_data_format }}','YYYY-MM-DD HH24:MI'));"  }'   > {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output
#
#
#
# -------------------------------------------------------------
# ---  OID instances ( Production, Recovery and Development --- added on 2024-03-18
# -------------------------------------------------------------
#
# --- Production --
#
# values ( 24, 'oid01p');
# values ( 25, 'oid02p');
#
# --- Recovery --
#
# values ( 26, 'oid01r');
# values ( 27, 'oid02r');
#
# --- Development --
#
# values ( 28, 'oid01d');
# values ( 29, 'oid02d');
#
# -------------------------------------
# ---  OID instance data Cleanup data ---
# -------------------------------------

#
# -- production oid01p
#
cat {{ working_log_dir }}/oid-oid01p-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oid-oid01p-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-oid01p-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-oid01p-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-oid01p-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-oid01p-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-oid01p-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-oid01p-instance-data.output   > {{ working_log_dir }}/working-01-oid-oid01p-instance-data.output
cat   {{ working_log_dir }}/working-01-oid-oid01p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 24," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oid-oid01p-instance-data.output
#

#
# -- production oid02p
#
cat {{ working_log_dir }}/oid-oid02p-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oid-oid02p-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-oid02p-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-oid02p-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-oid02p-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-oid02p-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-oid02p-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-oid02p-instance-data.output   > {{ working_log_dir }}/working-01-oid-oid02p-instance-data.output
cat   {{ working_log_dir }}/working-01-oid-oid02p-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 25," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oid-oid02p-instance-data.output
#


#
# -- Recovery oid01r
#
cat {{ working_log_dir }}/oid-oid01r-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oid-oid01r-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-oid01r-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-oid01r-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-oid01r-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-oid01r-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-oid01r-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-oid01r-instance-data.output   > {{ working_log_dir }}/working-01-oid-oid01r-instance-data.output
cat   {{ working_log_dir }}/working-01-oid-oid01r-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 26," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oid-oid01r-instance-data.output
#


#
# -- Recovery oid02r
#
cat {{ working_log_dir }}/oid-oid02r-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oid-oid02r-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-oid02r-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-oid02r-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-oid02r-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-oid02r-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-oid02r-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-oid02r-instance-data.output   > {{ working_log_dir }}/working-01-oid-oid02r-instance-data.output
cat   {{ working_log_dir }}/working-01-oid-oid02r-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 27," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oid-oid02r-instance-data.output
#



#
# -- Development oid01d
#
cat {{ working_log_dir }}/oid-oid01d-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oid-oid01d-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-oid01d-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-oid01d-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-oid01d-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-oid01d-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-oid01d-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-oid01d-instance-data.output   > {{ working_log_dir }}/working-01-oid-oid01d-instance-data.output
cat   {{ working_log_dir }}/working-01-oid-oid01d-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 28," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oid-oid01d-instance-data.output
#

#
# -- Development oid02d
#
cat {{ working_log_dir }}/oid-oid02d-instance-data.output |  grep -e '"display-name":' -e '"ocpus":'  > {{ working_log_dir }}/working-oid-oid02d-instance-data.output
sed -i 's|    "display-name": "||g'   {{ working_log_dir }}/working-oid-oid02d-instance-data.output
sed -i 's|    "ocpus": ||g'           {{ working_log_dir }}/working-oid-oid02d-instance-data.output
sed -i 's|",||g'                      {{ working_log_dir }}/working-oid-oid02d-instance-data.output
sed -i 's|,||g'                       {{ working_log_dir }}/working-oid-oid02d-instance-data.output
sed -i 's|.0||g'                      {{ working_log_dir }}/working-oid-oid02d-instance-data.output
#
paste -d " " - - < {{ working_log_dir }}/working-oid-oid02d-instance-data.output   > {{ working_log_dir }}/working-01-oid-oid02d-instance-data.output
cat   {{ working_log_dir }}/working-01-oid-oid02d-instance-data.output  | awk '{print  "insert into  etc_repository.ocpu_tracking_data values ( 29," , $2 , ",to_date(" "\x27" "{{ var_data_format }}" "\x27,\x27" "YYYY-MM-DD HH24:MI\x27));"  }'   > {{ working_log_dir }}/working-02-oid-oid02d-instance-data.output
#











# ---------------------------------------------------
# ---  Combine the file to create the insert file  --
# ---------------------------------------------------
#
# -----------
# ---ExaCC ---
# -----------
#
#
# ------------------
# --- production ---
# ------------------
#
#  1  {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output
#  2  {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output
#  3  {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output
#  4  {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output
#
# -----------
# --- bcc ---
# -----------
#
#  5  {{ working_log_dir }}/working-02-exacc-drcluster1-data.output
#  6  {{ working_log_dir }}/working-02-exacc-drcluster2-data.output
#
# ---------------------
# --- nonproduction ---
# ---------------------
#
#  7  {{ working_log_dir }}/working-02-exacc-devcluster1-data.output
#  8  {{ working_log_dir }}/working-02-exacc-devcluster2-data.output
#  9  {{ working_log_dir }}/working-02-exacc-devcluster3-data.output
# 10  {{ working_log_dir }}/working-02-exacc-devcluster4-data.output
#
# -----------
# --- OVK ---
# -----------
#
#
# 11  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output
# 12  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output
# 13  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output
# 14  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output
# 15  {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output
#
#
# ------------------
# --- GoldenGate ---
# ------------------
#
# 16  {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output
# 17  {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output
# 18  {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output
# 19  {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output
# 30  {{ working_log_dir }}/working-02-goldengate-GG_ETDC_OCI_MIG_DEP-data.output
#
# ---------
# -- OEM --
# ---------
#
# 20  {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output
# 21  {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output
# 22  {{ working_log_dir }}/working-02-oem-oem01p-system-data.output
# 23  {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output
#
#
# ---------
# -- OID --
# ---------
#
#   -- Production
#
# 24  {{ working_log_dir }}/working-02-oid-oid01p-instance-data.output
# 25  {{ working_log_dir }}/working-02-oid-oid01p-instance-data.output
#
#   -- Recovery
#
# 26  {{ working_log_dir }}/working-02-oid-oid01r-instance-data.output
# 27  {{ working_log_dir }}/working-02-oid-oid01r_instance-data.output
#
#   -- Development
#
# 28  {{ working_log_dir }}/working-02-oid-oid01d-instance-data.output
# 29  {{ working_log_dir }}/working-02-oid-oid01d_instance-data.output






# ------------------------
# --- ExaCC Production ---
# ------------------------
#
#
cat  {{ working_log_dir }}/working-02-exacc-prdcluster1-data.output                    >  {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-prdcluster2-data.output                    >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-prdcluster3-data.output                    >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-prdcluster4-data.output                    >> {{ working_log_dir }}/working-inserts.output
#
# -----------------
# --- ExaCC bcc ---
# -----------------
#
#
cat  {{ working_log_dir }}/working-02-exacc-drcluster1-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-drcluster2-data.output                      >> {{ working_log_dir }}/working-inserts.output
#
# ---------------------------
# --- ExaCC nonproduction ---
# ---------------------------
#
#
cat  {{ working_log_dir }}/working-02-exacc-devcluster1-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-devcluster2-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-devcluster3-data.output                      >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-exacc-devcluster4-data.output                      >> {{ working_log_dir }}/working-inserts.output
#
#
# -----------
# --- OVK ---
# -----------
#
#
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV01P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV02P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV03P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-CETORCXAPOKV04P-data.output          >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-working-01-ovk-ET-OKV-BK-OLE8-VM-data.output        >> {{ working_log_dir }}/working-inserts.output
#
#
# ------------------
# --- GoldenGate ---
# ------------------
#
#
cat  {{ working_log_dir }}/working-02-goldengate-GG_BD_SF_TST_NONREGFCQA_DEP-data.output  >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-goldengate-GG_MO_NONREGFC_DEP-data.output           >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-goldengate-GG_PROD_NONREG_DEP-data.output           >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-goldengate-GG_PROD_SCADA_DEP-data.output            >> {{ working_log_dir }}/working-inserts.output
#
cat  {{ working_log_dir }}/working-02-goldengate-GG_ETDC_OCI_MIG_DEP-data.output          >> {{ working_log_dir }}/working-inserts.output
#
# ---------
# -- OEM --
# ---------
#
cat  {{ working_log_dir }}/working-02-oem-oem01p-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oem-oem02p-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oem-oem01p-system-data.output                       >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oem-oem01p_stdby-system-data.output                 >> {{ working_log_dir }}/working-inserts.output
#
#
# ---------
# -- OID --
# ---------
#
#    -- Production --
#
cat  {{ working_log_dir }}/working-02-oid-oid01p-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oid-oid02p-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
#
#    -- Recovery --
#
cat  {{ working_log_dir }}/working-02-oid-oid01r-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oid-oid02r-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
#
#    -- Development --
#
cat  {{ working_log_dir }}/working-02-oid-oid01d-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
cat  {{ working_log_dir }}/working-02-oid-oid02d-instance-data.output                     >> {{ working_log_dir }}/working-inserts.output
#

#
echo 'commit;'   >> {{ working_log_dir }}/working-inserts.output
echo 'exit'      >> {{ working_log_dir }}/working-inserts.output
#
#
#
#
# ----------------------------------------------
# ---  Save the file for historcal reference  --
# ----------------------------------------------
#
cp -p {{ working_log_dir }}/working-inserts.output {{ save_data_path_name }}
#
#
#
# --------------------------------------------
# ---  Load the data into the OEM database  --
# --------------------------------------------
#
export LD_LIBRARY_PATH="/oracle/product/zdmhome/lib"
#
sqlplus -s etc_repository/{{var_etc_repository_password}}@OAITERP  @{{ working_log_dir }}/working-inserts.output
#
#
# EOF ( End-of-File)
---------------------------------------------------------------------------------------------------------------------------------------
